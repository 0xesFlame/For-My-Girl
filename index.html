<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURE ARCHIVE</title>
    <style>
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none; 
            touch-action: pan-y; /* –†–∞–∑—Ä–µ—à–∞–µ–º —Å–∫—Ä–æ–ª–ª, –Ω–æ –±–ª–æ–∫–∏—Ä—É–µ–º –∑—É–º */
        }

        /* --- –≠–ö–†–ê–ù 1: –í–•–û–î --- */
        #login-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            z-index: 10;
        }
        h1 { margin-bottom: 5px; text-shadow: 0 0 10px #0f0; }
        .subtitle { color: #fff; margin-bottom: 30px; font-size: 0.8em; opacity: 0.8; }
        
        input {
            padding: 10px;
            font-size: 1.2em;
            background: #111;
            border: 2px solid #0f0;
            color: #0f0;
            text-align: center;
            outline: none;
            margin-bottom: 20px;
            border-radius: 5px;
            width: 250px;
        }
        button.login-btn {
            padding: 10px 30px;
            font-size: 1.2em;
            background: #0f0;
            color: #000;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px;
            transition: 0.3s;
        }
        button.login-btn:hover { background: #fff; }
        .error-msg { color: red; display: none; margin-top: 15px; }

        /* --- –≠–ö–†–ê–ù 2: –õ–û–í–£–®–ö–ê --- */
        #trap-screen {
            display: none;
            flex-direction: column;
            align-items: center;
            background-color: #1a0000; 
            color: #ff3333;
            width: 100%;
            position: relative;
            padding-top: 50px;
            /* –í–ê–ñ–ù–û: 400 000 –ø–∏–∫—Å–µ–ª–µ–π –≤—ã—Å–æ—Ç—ã */
            height: 400000px; 
        }

        .trap-title {
            font-size: 3em;
            color: #ff0000;
            text-shadow: 0 0 10px #800000;
            margin-bottom: 10px;
        }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É */
        #runaway-btn {
            position: relative;
            margin-top: 30px;
            padding: 15px 30px;
            background: #ff0000;
            color: white;
            font-weight: bold;
            border: 2px solid white;
            cursor: pointer;
            font-size: 1.2em;
            box-shadow: 0 0 15px red;
            z-index: 100;
            transition: top 0.1s, left 0.1s; 
        }

        .fake-loader { width: 300px; border: 2px solid #ff3333; padding: 3px; margin: 20px auto; }
        .progress-bar { height: 15px; background-color: #ff3333; width: 0%; }

        .toggle-container { margin: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #330000; border: 1px solid red; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: red; transition: .4s; }
        input:checked + .slider { background-color: #ff3333; }
        input:checked + .slider:before { transform: translateX(22px); background-color: white; }

        .checkbox-container { margin-top: 15px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .checkbox-container input { width: 20px; height: 20px; margin: 0; cursor: pointer; }

        .help-link { margin-top: 30px; font-size: 0.8em; color: #777; text-decoration: underline; cursor: pointer; }
        .help-link:hover { color: #fff; }

        .popup {
            position: absolute;
            background: #ccc;
            color: black;
            border: 2px solid blue;
            padding: 5px;
            font-family: Arial, sans-serif;
            font-size: 11px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.5);
            z-index: 50;
            width: 180px;
            text-align: left;
            user-select: none;
        }
        .popup-header { background: blue; color: white; padding: 2px; margin-bottom: 5px; font-weight: bold; }

        /* --- –ì–ï–ô–¢–´ --- */
        .gate-overlay {
            display: none; 
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 500;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: red;
            border: 5px solid red;
        }
        .gate-box {
            background: #220000;
            padding: 20px;
            border: 2px solid red;
            max-width: 90%;
            text-align: center;
        }
        .timer-display {
            font-size: 2em;
            color: #fff;
            font-weight: bold;
            margin: 10px 0;
            border: 1px solid white;
            padding: 5px;
            display: inline-block;
            min-width: 60px;
        }

        /* 2048 STYLES */
        .grid-2048 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            background: #555;
            padding: 5px;
            border-radius: 5px;
            margin: 10px auto;
            width: 240px;
            height: 240px;
        }
        .cell-2048 {
            width: 55px;
            height: 55px;
            background: #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            font-weight: bold;
            color: #333;
            border-radius: 3px;
        }
        .c-0 { background: #cdc1b4; color: transparent; }
        .c-2 { background: #eee4da; }
        .c-4 { background: #ede0c8; }
        .c-8 { background: #f2b179; color: #f9f6f2; }
        .c-16 { background: #f59563; color: #f9f6f2; }
        .c-32 { background: #f67c5f; color: #f9f6f2; }
        .c-64 { background: #f65e3b; color: #f9f6f2; }
        .c-128 { background: #edcf72; color: #f9f6f2; }
        .c-256 { background: #edcc61; color: #f9f6f2; }
        .c-512 { background: #edc850; color: #f9f6f2; }
        .c-1024 { background: #edc53f; color: #f9f6f2; }
        .c-2048 { background: #edc22e; color: #f9f6f2; box-shadow: 0 0 10px yellow; }

        .controls-2048 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            max-width: 200px;
            margin: 10px auto;
        }
        .btn-2048 {
            padding: 10px;
            background: #444;
            color: white;
            border: 1px solid #777;
            font-size: 1.2em;
            cursor: pointer;
        }

        /* –°–ö–†–ò–ú–ï–† */
        #screamer-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black;
            z-index: 9999;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        .screamer-face { font-size: 8em; animation: shake 0.1s infinite; }
        .screamer-text { color: red; font-size: 3em; font-weight: bold; }

        /* –°–µ–∫—Ä–µ—Ç –≤–Ω–∏–∑—É */
        .secret-container {
            position: absolute;
            bottom: 50px;
            width: 100%;
        }
        .secret-text {
            color: #240000; 
            font-size: 14px;
            font-weight: bold;
            transition: color 0.2s;
            user-select: text;
        }
        .secret-text::selection { background: white; color: black; }

        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            100% { transform: translate(1px, -1px) rotate(1deg); }
        }

    </style>
</head>
<body>

    <!-- –í–•–û–î -->
    <div id="login-screen">
        <h1>–°–ò–°–¢–ï–ú–ê –ù–ê–í–ï–î–ï–ù–ò–Ø</h1>
        <div class="subtitle">–í–í–ï–î–ò–¢–ï –ö–û–î –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ö–û–û–†–î–ò–ù–ê–¢</div>
        <input type="text" id="passwordInput" placeholder="–ö–û–î –î–û–°–¢–£–ü–ê">
        <button class="login-btn" onclick="checkPassword()">–ü–û–õ–£–ß–ò–¢–¨</button>
        <p class="error-msg" id="errorMsg">–ù–ï–í–ï–†–ù–´–ô –ö–û–î</p>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù -->
    <div id="trap-screen" onclick="randomPopup(event)">
        <div style="position: sticky; top: 20px; z-index: 200;">
            <div class="trap-title">–í–ó–õ–û–ú –°–ò–°–¢–ï–ú–´</div>
            <p>–ü–†–û–¢–û–ö–û–õ –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–Ø –ó–ê–ü–£–©–ï–ù</p>
            <div class="fake-loader"><div class="progress-bar" id="progBar"></div></div>
            <div id="statusText" style="font-size: 0.8em; margin-bottom: 20px;">–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>

        <button id="runaway-btn" onmouseover="moveButton()">–°–ö–ê–ß–ê–¢–¨ –ö–û–û–†–î–ò–ù–ê–¢–´</button>

        <div class="toggle-container" onclick="stopProp(event)">
            <span>–°–ª–æ–∂–Ω–æ</span>
            <label class="switch">
                <input type="checkbox" id="trollSwitch" onchange="trollToggle()">
                <span class="slider"></span>
            </label>
            <span>–õ–µ–≥–∫–æ</span>
        </div>

        <div class="checkbox-container" onclick="stopProp(event)">
            <input type="checkbox" id="humanCheck" onchange="noHuman(this)">
            <label for="humanCheck">–Ø –Ω–µ —Ä–æ–±–æ—Ç</label>
        </div>

        <div class="help-link" onclick="triggerScreamer(event)">[ ? ] –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?</div>

        <div style="margin-top: 50px; opacity: 0.5;">
            01010101 SYSTEM ERROR<br>SCROLL DOWN TO REBOOT...
        </div>

        <!-- –°–ï–ö–†–ï–¢ -->
        <div class="secret-container" onclick="stopProp(event)">
            <p class="secret-text">
                –¢—ã –ø—Ä–æ—Å—Ç–æ –≥–µ—Ä–æ–π.<br>
                –°–ª–µ–¥—É—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–∏–∫–ª–µ–µ–Ω–∞ —Å–∫–æ—Ç—á–µ–º<br>
                –ó–ê –¢–í–û–ò–ú –¢–ï–õ–ï–í–ò–ó–û–†–û–ú.
            </p>
        </div>
    </div>

    <!-- === –ì–ï–ô–¢ 1: –ó–ê–ì–ê–î–ö–ê (–û–∫–æ–ª–æ 30 000px) === -->
    <div id="gate1" class="gate-overlay">
        <div class="gate-box">
            <h2>–ó–ê–©–ò–¢–ê –£–†–û–í–ï–ù–¨ 1</h2>
            <p>–ß—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø—É—Å–∫–∞–µ—Ç—Å—è?</p>
            <input type="text" id="ans1" class="gate-input" placeholder="–û—Ç–≤–µ—Ç..." style="font-size: 1.2em; padding: 5px;">
            <br>
            <button class="login-btn" onclick="checkGate1()" style="margin-top:10px;">–û–¢–í–ï–¢–ò–¢–¨</button>
        </div>
    </div>

    <!-- === –ì–ï–ô–¢ 2: –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê (–û–∫–æ–ª–æ 120 000px) === -->
    <div id="gate2" class="gate-overlay">
        <div class="gate-box">
            <h2>–ó–ê–©–ò–¢–ê –£–†–û–í–ï–ù–¨ 2</h2>
            <p>–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä –∑–∞ 20 —Å–µ–∫—É–Ω–¥!</p>
            <div id="math-timer" class="timer-display">20</div>
            <h1 id="math-problem" style="color:white; font-size: 2em; margin: 20px 0;">2 + 2 = ?</h1>
            <input type="number" id="ans2" class="gate-input" placeholder="–ß–∏—Å–ª–æ...">
            <br>
            <button class="login-btn" onclick="checkGate2()" style="margin-top:10px;">–û–¢–í–ï–¢–ò–¢–¨</button>
        </div>
    </div>

    <!-- === –ì–ï–ô–¢ 3: –ö–õ–ò–ö–ï–† (–û–∫–æ–ª–æ 250 000px) === -->
    <div id="gate3" class="gate-overlay">
        <div class="gate-box">
            <h2>–ó–ê–©–ò–¢–ê –£–†–û–í–ï–ù–¨ 3</h2>
            <p>–ù–∞–∂–º–∏ 10 —Ä–∞–∑ –∑–∞ 3 —Å–µ–∫—É–Ω–¥—ã!</p>
            <div id="click-timer" class="timer-display">3.00</div>
            <p>–û—Å—Ç–∞–ª–æ—Å—å: <span id="clickCount" style="color:white; font-size:1.5em;">10</span></p>
            <div style="height: 250px; position: relative; border: 1px dashed #555;">
                <button id="clickGameBtn" onclick="clickerGame()" style="padding: 10px; background: red; color: white; border: none; font-weight: bold; position: absolute; top: 40%; left: 40%;">–ñ–ú–ò!</button>
            </div>
            <button onclick="startClicker()" id="startClickBtn" style="padding: 10px; background: blue; color: white; border: none; width: 100%; margin-top: 10px;">–ù–ê–ß–ê–¢–¨</button>
        </div>
    </div>

    <!-- === –ì–ï–ô–¢ 4: 2048 (–û–∫–æ–ª–æ 380 000px) === -->
    <div id="gate4" class="gate-overlay">
        <div class="gate-box">
            <h2>–§–ò–ù–ê–õ–¨–ù–´–ô –ë–û–°–°</h2>
            <p>–°–æ–±–µ—Ä–∏ —á–∏—Å–ª–æ 2048, —á—Ç–æ–±—ã –ø—Ä–æ–π—Ç–∏.</p>
            <div class="grid-2048" id="grid2048"></div>
            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ -->
            <div class="controls-2048">
                <div></div><button class="btn-2048" onclick="game2048.move('up')">‚¨ÜÔ∏è</button><div></div>
                <button class="btn-2048" onclick="game2048.move('left')">‚¨ÖÔ∏è</button>
                <button class="btn-2048" onclick="game2048.move('down')">‚¨áÔ∏è</button>
                <button class="btn-2048" onclick="game2048.move('right')">‚û°Ô∏è</button>
            </div>
        </div>
    </div>

    <!-- –°–ö–†–ò–ú–ï–† -->
    <div id="screamer-overlay">
        <div class="screamer-face">üëπ</div>
        <div class="screamer-text">–ë–£!</div>
    </div>

    <script>
        function stopProp(e) { e.stopPropagation(); }

        // --- –õ–û–ì–ò–ö–ê –ü–ê–†–û–õ–Ø ---
        function checkPassword() {
            var input = document.getElementById("passwordInput").value;
            if (input.toUpperCase().trim() === "–ö–ü–Æ–õ–ü") {
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("trap-screen").style.display = "flex";
                document.body.style.backgroundColor = "#1a0000"; 
                startFakeLoading();
                window.addEventListener('scroll', checkScrollTraps);
            } else {
                document.getElementById("errorMsg").style.display = "block";
                document.getElementById("passwordInput").value = "";
            }
        }

        // --- –û–ë–†–ê–ë–û–¢–ö–ê –°–ö–†–û–õ–õ–ê ---
        let passed1 = false;
        let passed2 = false;
        let passed3 = false;
        let passed4 = false;

        function checkScrollTraps() {
            let y = window.scrollY;
            
            // 30,000px - –ó–∞–≥–∞–¥–∫–∞
            if (y > 30000 && !passed1) {
                document.getElementById('gate1').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
            // 120,000px - –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞
            if (y > 120000 && !passed2) {
                prepareMath();
                document.getElementById('gate2').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
            // 250,000px - –ö–ª–∏–∫–µ—Ä
            if (y > 250000 && !passed3) {
                document.getElementById('gate3').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
            // 380,000px - 2048
            if (y > 380000 && !passed4) {
                game2048.init();
                document.getElementById('gate4').style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        // === –û–ë–©–ò–ô –°–ë–†–û–° ===
        function failGate(reason) {
            alert("–û–®–ò–ë–ö–ê: " + reason + "\n–í–û–ó–í–†–ê–¢ –í –ù–ê–ß–ê–õ–û!");
            window.scrollTo(0, 0); 
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≥–µ–π—Ç—ã
            document.querySelectorAll('.gate-overlay').forEach(el => el.style.display = 'none');
            document.body.style.overflow = 'auto';
            
            // –°–±—Ä–æ—Å –ø–æ–ª–µ–π
            document.getElementById('ans1').value = "";
            document.getElementById('ans2').value = "";
            
            // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–æ–≤
            clearInterval(mathInterval);
            clearInterval(clickInterval);
        }

        // === –ì–ï–ô–¢ 1: –ó–ê–ì–ê–î–ö–ê ===
        function checkGate1() {
            let ans = document.getElementById('ans1').value.toLowerCase().trim();
            if (ans === "–≤–æ–∑—Ä–∞—Å—Ç" || ans === "–≥–æ–¥—ã" || ans === "–≤—Ä–µ–º—è") {
                passed1 = true;
                document.getElementById('gate1').style.display = 'none';
                document.body.style.overflow = 'auto';
                alert("–ü–†–ò–ù–Ø–¢–û. –ò–¥–µ–º –¥–∞–ª—å—à–µ...");
            } else {
                failGate("–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç");
            }
        }

        // === –ì–ï–ô–¢ 2: –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê (–†–ê–ù–î–û–ú + –¢–ê–ô–ú–ï–†) ===
        let currentMathAnswer = 0;
        let mathInterval;

        function prepareMath() {
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∞
            let types = ['+', '-', '*'];
            let type = types[Math.floor(Math.random() * types.length)];
            let a = Math.floor(Math.random() * 20) + 1;
            let b = Math.floor(Math.random() * 20) + 1;
            
            if (type === '*') { // –ß—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ
                a = Math.floor(Math.random() * 10) + 1;
                b = Math.floor(Math.random() * 10) + 1;
                currentMathAnswer = a * b;
            } else if (type === '+') {
                currentMathAnswer = a + b;
            } else {
                currentMathAnswer = a - b;
            }

            document.getElementById('math-problem').innerText = `${a} ${type} ${b} = ?`;
            
            // –¢–∞–π–º–µ—Ä 20 —Å–µ–∫
            let timeLeft = 20;
            document.getElementById('math-timer').innerText = timeLeft;
            mathInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('math-timer').innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(mathInterval);
                    failGate("–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ");
                }
            }, 1000);
        }

        function checkGate2() {
            let ans = parseInt(document.getElementById('ans2').value);
            if (ans === currentMathAnswer) {
                clearInterval(mathInterval);
                passed2 = true;
                document.getElementById('gate2').style.display = 'none';
                document.body.style.overflow = 'auto';
                alert("–í–ï–†–ù–û. –ì–æ—Ç–æ–≤—å –ø–∞–ª—å—Ü—ã.");
            } else {
                failGate("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç");
            }
        }

        // === –ì–ï–ô–¢ 3: –ö–õ–ò–ö–ï–† (3 —Å–µ–∫—É–Ω–¥—ã) ===
        let clicksLeft = 10;
        let clickGameActive = false;
        let clickInterval;

        function startClicker() {
            if(clickGameActive) return;
            clickGameActive = true;
            clicksLeft = 10;
            document.getElementById('clickCount').innerText = clicksLeft;
            document.getElementById('startClickBtn').style.display = 'none';

            let timeLeft = 3.00;
            document.getElementById('click-timer').innerText = "3.00";

            clickInterval = setInterval(() => {
                timeLeft -= 0.01;
                document.getElementById('click-timer').innerText = timeLeft.toFixed(2);
                if (timeLeft <= 0) {
                    clearInterval(clickInterval);
                    clickGameActive = false;
                    document.getElementById('startClickBtn').style.display = 'block';
                    failGate("–°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ!");
                }
            }, 10);
        }

        function clickerGame() {
            if (!clickGameActive) return;

            clicksLeft--;
            document.getElementById('clickCount').innerText = clicksLeft;
            
            // –ü—Ä—ã–∂–æ–∫ –∫–Ω–æ–ø–∫–∏
            let btn = document.getElementById('clickGameBtn');
            let randX = Math.random() * 200 - 100;
            let randY = Math.random() * 200 - 100;
            btn.style.transform = `translate(${randX}px, ${randY}px)`;

            if (clicksLeft <= 0) {
                clearInterval(clickInterval);
                clickGameActive = false;
                passed3 = true;
                document.getElementById('gate3').style.display = 'none';
                document.body.style.overflow = 'auto';
                alert("–£–°–ü–ï–•. –í–ø–µ—Ä–µ–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–æ—Å—Å.");
            }
        }

        // === –ì–ï–ô–¢ 4: 2048 ===
        const game2048 = {
            board: [],
            score: 0,
            init: function() {
                this.board = Array(4).fill().map(() => Array(4).fill(0));
                this.spawn();
                this.spawn();
                this.draw();
                // –°–ª—É—à–∞–µ–º –∫–ª–∞–≤–∏—à–∏
                document.addEventListener('keydown', this.handleKey);
            },
            spawn: function() {
                let empty = [];
                for(let r=0; r<4; r++)
                    for(let c=0; c<4; c++)
                        if(this.board[r][c] === 0) empty.push({r,c});
                
                if(empty.length > 0) {
                    let spot = empty[Math.floor(Math.random() * empty.length)];
                    this.board[spot.r][spot.c] = Math.random() < 0.9 ? 2 : 4;
                }
            },
            draw: function() {
                let html = '';
                let won = false;
                for(let r=0; r<4; r++) {
                    for(let c=0; c<4; c++) {
                        let val = this.board[r][c];
                        let cls = 'c-' + val;
                        html += `<div class="cell-2048 ${cls}">${val > 0 ? val : ''}</div>`;
                        if(val === 2048) won = true;
                    }
                }
                document.getElementById('grid2048').innerHTML = html;
                if(won) {
                    setTimeout(() => {
                        alert("–¢–´ –ü–û–ë–ï–î–ò–õ–ê! –ü–£–¢–¨ –û–¢–ö–†–´–¢!");
                        passed4 = true;
                        document.getElementById('gate4').style.display = 'none';
                        document.body.style.overflow = 'auto';
                        document.removeEventListener('keydown', this.handleKey);
                    }, 500);
                }
            },
            move: function(dir) {
                let moved = false;
                // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ 2048
                const rotate = matrix => matrix[0].map((val, index) => matrix.map(row => row[index]).reverse());
                let b = this.board;
                
                // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∫ "–¥–≤–∏–∂–µ–Ω–∏—é –≤–ª–µ–≤–æ"
                if(dir === 'right') b = rotate(rotate(b));
                if(dir === 'down') b = rotate(b);
                if(dir === 'up') b = rotate(rotate(rotate(b)));

                // –°–¥–≤–∏–≥ –≤–ª–µ–≤–æ
                for(let r=0; r<4; r++) {
                    let row = b[r].filter(x => x); // –£–±—Ä–∞—Ç—å –Ω—É–ª–∏
                    for(let i=0; i < row.length - 1; i++) {
                        if(row[i] === row[i+1]) {
                            row[i] *= 2;
                            row[i+1] = 0;
                        }
                    }
                    row = row.filter(x => x); // –°–Ω–æ–≤–∞ —É–±—Ä–∞—Ç—å –Ω—É–ª–∏ –ø–æ—Å–ª–µ —Å–ª–∏—è–Ω–∏—è
                    while(row.length < 4) row.push(0);
                    if(b[r].join(',') !== row.join(',')) moved = true;
                    b[r] = row;
                }

                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ–≤–æ—Ä–æ—Ç
                if(dir === 'right') b = rotate(rotate(b));
                if(dir === 'down') b = rotate(rotate(rotate(b)));
                if(dir === 'up') b = rotate(b);

                this.board = b;
                if(moved) {
                    this.spawn();
                    this.draw();
                }
            },
            handleKey: function(e) {
                if(e.key === 'ArrowUp') game2048.move('up');
                if(e.key === 'ArrowDown') game2048.move('down');
                if(e.key === 'ArrowLeft') game2048.move('left');
                if(e.key === 'ArrowRight') game2048.move('right');
            }
        };

        // --- –ü–†–û–®–õ–´–ï –§–£–ù–ö–¶–ò–ò ---
        function moveButton() {
            var btn = document.getElementById("runaway-btn");
            var x = Math.random() * (window.innerWidth - 200);
            if(x<0) x=0;
            var y = Math.random() * 300; 
            btn.style.position = "absolute";
            btn.style.left = x + "px";
            btn.style.top = (y + 150) + "px"; 
        }

        function trollToggle() {
            var chk = document.getElementById("trollSwitch");
            if (chk.checked) {
                setTimeout(() => { chk.checked = false; alert("–û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞!"); }, 300);
            }
        }

        function noHuman(chk) {
            if (chk.checked) {
                setTimeout(() => { chk.checked = false; alert("–†–æ–±–æ—Ç–∞–º –≤—Ö–æ–¥ –∑–∞–ø—Ä–µ—â–µ–Ω! ü§ñ"); }, 300);
            }
        }

        function triggerScreamer(e) {
            e.stopPropagation();
            var scr = document.getElementById("screamer-overlay");
            scr.style.display = "flex";
            var count = 0;
            var inter = setInterval(() => {
                scr.style.backgroundColor = (scr.style.backgroundColor === 'black') ? 'red' : 'black';
                count++;
                if(count > 10) { 
                    clearInterval(inter);
                    scr.style.display = "none";
                }
            }, 100);
        }

        function randomPopup(e) {
            if(e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'LABEL') return;
            if (Math.random() > 0.4) return; 
            var div = document.createElement("div");
            div.className = "popup";
            div.innerHTML = "<div class='popup-header'>System Error</div>VIRUS DETECTED<br>Sending data...";
            div.style.left = (e.clientX) + "px";
            div.style.top = (e.clientY + window.scrollY) + "px";
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 1500);
        }

        function startFakeLoading() {
            var bar = document.getElementById("progBar");
            var width = 0;
            setInterval(() => {
                if (width >= 100) width = 0;
                else width += 2;
                bar.style.width = width + '%';
            }, 50);
        }
    </script>

</body>
</html>
