<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURE ARCHIVE</title>
    <style>
        /* –°–ö–†–´–í–ê–ï–ú –ü–û–õ–û–°–£ –ü–†–û–ö–†–£–¢–ö–ò */
        ::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }

        body {
            background-color: #000;
            color: #ff3333;
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            margin: 0; padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none; 
            touch-action: pan-y;
            transition: filter 0.2s, color 0.5s; 
            text-shadow: 2px 2px 0 #000, -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;
        }

        /* --- –ó–ï–õ–ï–ù–ê–Ø –¢–ï–ú–ê (–°–¢–ò–õ–ò) --- */
        body.green-theme { color: #00ff00 !important; }
        body.green-theme .trap-title { color: #00ff00 !important; text-shadow: 3px 3px 0 #000, 0 0 20px #00ff00 !important; }
        body.green-theme .fake-loader { border-color: #00ff00 !important; box-shadow: 0 0 10px #00ff00 !important; }
        body.green-theme .progress-bar { background-color: #00ff00 !important; }
        body.green-theme .big-cipher { color: #005500 !important; }
        
        /* –ò–ù–î–ò–ö–ê–¢–û–† –ü–†–û–ì–†–ï–°–°–ê */
        #progress-indicator {
            position: fixed; top: 10px; right: 10px;
            background: rgba(0,0,0,0.8); color: inherit; border: 1px solid currentColor;
            padding: 5px 10px; font-weight: bold; z-index: 9000;
            font-size: 14px; display: none; cursor: pointer;
        }
        #progress-indicator:active { background: #004400; }

        /* –ú–ê–ì–ê–ó–ò–ù */
        #open-shop-btn {
            position: fixed; top: 10px; left: 10px;
            background: #000; color: gold; border: 2px solid gold;
            padding: 5px 10px; font-weight: bold; z-index: 9000;
            cursor: pointer; display: none;
        }
        #shop-modal {
            display: none; position: fixed; top: 50px; left: 10px;
            background: rgba(0,0,0,0.95); border: 2px solid gold;
            color: gold; padding: 15px; z-index: 9100; text-align: left;
            width: 240px; font-size: 12px; box-shadow: 0 0 15px gold;
            max-height: 80vh; overflow-y: auto;
        }
        .shop-title { text-align: center; border-bottom: 1px solid gold; margin-bottom: 10px; padding-bottom: 5px; font-size: 1.2em; }
        .shop-btn {
            background: #333; color: gold; border: 1px solid gold;
            width: 100%; margin-top: 8px; cursor: pointer; padding: 8px;
            text-align: left; display: flex; justify-content: space-between;
        }
        .shop-btn:hover { background: #555; }

        /* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ */
        #admin-modal {
            display: none; position: fixed; bottom: 20px; right: 20px;
            background: #111; border: 2px solid #0f0; color: #0f0; padding: 10px; z-index: 99999;
            width: 320px; text-align: center; box-shadow: 0 0 20px #0f0; height: 450px; overflow-y: auto;
        }
        .admin-tabs { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #0f0; padding-bottom: 5px; }
        .tab-btn { background: none; border: none; color: #005500; cursor: pointer; font-weight: bold; padding: 5px; flex: 1; border-bottom: 2px solid transparent;}
        .tab-btn.active { color: #0f0; border-bottom: 2px solid #0f0; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .admin-btn { background: #003300; color: #0f0; border: 1px solid #0f0; width: 100%; padding: 8px; margin: 3px 0; cursor: pointer; font-size: 11px; font-weight: bold; }
        .admin-btn:hover { background: #006600; color: white; }
        .admin-input { background: black; color: white; border: 1px solid #0f0; padding: 5px; width: 60px; text-align: center; }

        /* –ö–ï–ô–° */
        #case-modal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; border: 4px solid gold; width: 300px; height: 150px; z-index: 9500;
            overflow: hidden;
        }
        .case-window { width: 100%; height: 100px; margin-top: 25px; background: #000; position: relative; overflow: hidden; border-top: 2px solid #555; border-bottom: 2px solid #555; }
        .case-strip { display: flex; height: 100%; position: absolute; left: 0; top: 0; transition: transform 10s cubic-bezier(0.1, 1, 0.1, 1); }
        .case-item { width: 96px; height: 96px; border-right: 4px solid #000; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; color: black; flex-shrink: 0; }
        .case-marker { position: absolute; top: 0; left: 148px; width: 4px; height: 100%; background: red; z-index: 10; }

        /* --- –•–ê–û–° --- */
        .zoom-in-mode { transform: scale(1.8); } .zoom-out-mode { transform: scale(0.4); }
        .fake-cursor { position: fixed; width: 20px; height: 30px; background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="30" viewBox="0 0 320 512"><path fill="white" d="M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 6.407 31.141-12.5 31.141z"/></svg>') no-repeat; z-index: 9998; pointer-events: none; transition: 0.1s; }
        .fake-cursor-img { position: fixed; width: 20px; height: 30px; background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="30" viewBox="0 0 320 512"><path fill="white" d="M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 6.407 31.141-12.5 31.141z"/></svg>') no-repeat; z-index: 9999; pointer-events: none; transition: 0.05s; }
        .fly { position: fixed; font-size: 30px; z-index: 9999; pointer-events: none; transition: top 0.2s, left 0.2s; }
        .chat-notification { position: fixed; top: 50px; right: -300px; background: #222; border: 1px solid #0f0; color: #0f0; padding: 10px; width: 250px; text-align: left; font-size: 12px; z-index: 9000; transition: right 0.5s; box-shadow: 0 0 10px #0f0; text-shadow: none; }
        .earthquake-mode { animation: hard-shake 0.1s infinite; }
        @keyframes hard-shake { 0% { transform: translate(5px, 5px) rotate(0deg); } 50% { transform: translate(-5px, -5px) rotate(2deg); } 100% { transform: translate(0, 0) rotate(0); } }
        .taco { position: fixed; top: -100px; font-size: 60px; z-index: 9000; pointer-events: none; animation: fall linear forwards; text-shadow: none; }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); } }
        .drunk-mode { transform: scaleY(-1) scaleX(-1); filter: hue-rotate(90deg); }
        .no-cursor { cursor: none !important; }
        .blur-mode { filter: blur(5px); }
        .invert-mode { filter: invert(100%); }
        .pulse-mode { animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .gravity-fall > * { animation: falling 2s infinite ease-in-out; }
        @keyframes falling { 0% { transform: translateY(0); } 50% { transform: translateY(50px) rotate(5deg); } 100% { transform: translateY(0); } }
        #blackout-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 10000; pointer-events: none; }

        /* --- BASIC --- */
        canvas { display: block; position: fixed; top: 0; left: 0; z-index: 0; opacity: 1; pointer-events: none; }
        #login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; position: relative; background: #000; z-index: 2000; }
        input, button.login-btn { position: relative; z-index: 2001; }
        h1 { margin-bottom: 5px; color: #0f0; text-shadow: 0 0 10px #0f0; }
        .subtitle { color: #fff; margin-bottom: 30px; font-size: 0.8em; opacity: 0.8; text-shadow: none; }
        input { padding: 10px; font-size: 1.2em; background: #111; border: 2px solid #0f0; color: #0f0; text-align: center; outline: none; margin-bottom: 20px; border-radius: 5px; width: 250px; text-shadow: none; }
        button.login-btn { padding: 10px 30px; font-size: 1.2em; background: #0f0; color: #000; border: none; cursor: pointer; font-weight: bold; border-radius: 5px; transition: 0.3s; text-shadow: none; }
        button.login-btn:hover { background: #fff; }
        .error-msg { color: red; display: none; margin-top: 15px; text-shadow: none; }

        #trap-screen {
            display: none; flex-direction: column; align-items: center;
            background-color: rgba(0, 0, 0, 0.4); width: 100%; position: relative; padding-top: 50px;
            z-index: 1; height: 1250000px; 
        }
        .trap-title { font-size: 3em; color: #ff0000; text-shadow: 3px 3px 0 #000, 0 0 20px #ff0000; margin-bottom: 10px; padding: 10px; }
        
        .big-cipher { width: 90%; word-break: break-all; font-size: 10px; opacity: 0.5; color: #880000; text-shadow: none; margin-top: 30px; font-family: monospace; text-align: left; overflow: hidden; height: 200px; mask-image: linear-gradient(to bottom, black 50%, transparent 100%); pointer-events: none; }
        
        /* –ö–ù–û–ü–ö–ê –ö–û–û–†–î–ò–ù–ê–¢ - –¢–û–õ–¨–ö–û –í –ù–ê–ß–ê–õ–ï */
        #runaway-btn { 
            position: absolute; top: 250px; 
            padding: 15px 30px; background: #ff0000; color: white; font-weight: bold; border: 2px solid white; 
            cursor: pointer; font-size: 1.2em; box-shadow: 0 0 15px red; z-index: 50; transition: 0.1s; text-shadow: none; 
        }
        
        .fake-loader { width: 300px; border: 2px solid #ff3333; padding: 3px; margin: 20px auto; background: black; box-shadow: 0 0 10px #000; }
        .progress-bar { height: 15px; background-color: #ff3333; width: 0%; }
        .toggle-container { margin: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; padding: 5px; border-radius: 10px; z-index: 100; position: relative;}
        .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #330000; border: 1px solid red; transition: .4s; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: red; transition: .4s; }
        input:checked + .slider { background-color: #ff3333; }
        input:checked + .slider:before { transform: translateX(22px); background-color: white; }
        .checkbox-container { margin-top: 15px; display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 5px; border-radius: 5px; z-index: 100; position: relative;}
        .checkbox-container input { width: 20px; height: 20px; margin: 0; cursor: pointer; }
        .help-link { margin-top: 30px; font-size: 0.8em; color: #fff; text-decoration: underline; cursor: pointer; background: #000; padding: 5px; text-shadow: none; z-index: 100; position: relative;}
        .help-link:hover { color: red; }
        .popup { position: absolute; background: #ccc; color: black; border: 2px solid blue; padding: 5px; font-family: Arial, sans-serif; font-size: 11px; box-shadow: 5px 5px 10px rgba(0,0,0,0.5); z-index: 50; width: 180px; text-align: left; user-select: none; text-shadow: none; }
        .popup-header { background: blue; color: white; padding: 2px; margin-bottom: 5px; font-weight: bold; }
        .skip-trap-btn { position: fixed; bottom: 20px; right: 20px; background: #ffaa00; color: black; padding: 10px 20px; font-weight: bold; border: 2px solid white; cursor: pointer; z-index: 400; display: none; box-shadow: 0 0 10px yellow; animation: bounce 1s infinite; text-shadow: none; }
        @keyframes bounce { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-5px);} }
        
        /* GATES */
        .gate-overlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 5000; flex-direction: column; 
            align-items: center; justify-content: center; color: red; border: 5px solid red; text-shadow: none; 
        }
        .gate-box { background: #220000; padding: 20px; border: 2px solid red; max-width: 90%; text-align: center; }
        .timer-display { font-size: 2em; color: #fff; font-weight: bold; margin: 10px 0; border: 1px solid white; padding: 5px; display: inline-block; min-width: 60px; }
        
        .grid-2048 { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: #555; padding: 5px; border-radius: 5px; margin: 10px auto; width: 300px; height: 300px; }
        .cell-2048 { width: 38px; height: 38px; background: #ccc; display: flex; justify-content: center; align-items: center; font-size: 12px; font-weight: bold; color: #333; border-radius: 3px; text-shadow: none; }
        .c-0 { background: #cdc1b4; color: transparent; } .c-2 { background: #eee4da; } .c-4 { background: #ede0c8; } .c-8 { background: #f2b179; color: #f9f6f2; } .c-16 { background: #f59563; color: #f9f6f2; } .c-32 { background: #f67c5f; color: #f9f6f2; } .c-64 { background: #f65e3b; color: #f9f6f2; } .c-128 { background: #edcf72; color: #f9f6f2; } .c-256 { background: #edcc61; color: #f9f6f2; } .c-512 { background: #edc850; color: #f9f6f2; } .c-1024 { background: #edc53f; color: #f9f6f2; } .c-2048 { background: #edc22e; color: #f9f6f2; box-shadow: 0 0 10px yellow; }
        .controls-2048 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; max-width: 200px; margin: 10px auto; }
        .btn-2048 { padding: 10px; background: #444; color: white; border: 1px solid #777; font-size: 1.2em; cursor: pointer; text-shadow: none;}
        
        /* –û–ü–õ–ê–¢–ê */
        #payment-modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: black; border: 3px solid blue; padding: 20px; z-index: 6000; width: 300px; text-align: center; box-shadow: 0 0 50px black; text-shadow: none; }
        .pay-btn { background: green; color: white; padding: 10px; border: none; cursor: pointer; position: relative; }
        
        #screamer-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; align-items: center; justify-content: center; flex-direction: column; }
        .screamer-face { font-size: 8em; animation: shake 0.1s infinite; text-shadow: none;}
        .screamer-text { color: red; font-size: 3em; font-weight: bold; text-shadow: none;}
        .secret-container { position: absolute; bottom: 50px; width: 100%; }
        .secret-text { color: #330000; font-size: 14px; font-weight: bold; transition: color 0.2s; user-select: text; text-shadow: none; }
        .secret-text::selection { background: white; color: black; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 100% { transform: translate(1px, -1px) rotate(1deg); } }

        .stroop-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stroop-btn { padding: 15px; font-weight: bold; border: 2px solid white; cursor: pointer; color: black; text-shadow: none; }
        #hellSlider { width: 100%; margin: 20px 0; }
        #dontPressBtn { width: 150px; height: 150px; border-radius: 50%; background: red; color: white; font-weight: bold; font-size: 1.5em; border: 5px solid darkred; cursor: pointer; box-shadow: 0 0 20px red; text-shadow: none; }

        #maze-container { width: 300px; height: 300px; background: #fff; position: relative; margin: 0 auto; cursor: crosshair; }
        .maze-wall { position: absolute; background: red; }
        .maze-start { position: absolute; top: 0; left: 0; width: 30px; height: 30px; background: lime; color: black; font-size: 10px; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .maze-end { position: absolute; bottom: 0; right: 0; width: 30px; height: 30px; background: lime; color: black; font-size: 10px; display: flex; align-items: center; justify-content: center; z-index: 10; }

        .odd-grid { display: grid; grid-template-columns: repeat(10, 1fr); gap: 2px; width: 300px; margin: 0 auto; }
        .odd-cell { font-size: 20px; cursor: pointer; user-select: none; }

        .sheep-field { width: 300px; height: 200px; background: #2e8b57; position: relative; margin: 0 auto; border: 2px solid white; }
        .sheep { font-size: 30px; position: absolute; cursor: pointer; transition: 0.2s; }
        .grass { font-size: 30px; position: absolute; cursor: grab; }

        .flag-img { font-size: 80px; margin: 20px; }
        .flag-opts button { width: 100%; margin: 5px 0; }

        .mine-grid { display: grid; grid-template-columns: repeat(8, 1fr); gap: 2px; background: #555; padding: 5px; border-radius: 5px; margin: 10px auto; width: 240px; height: 240px; }
        .mine-cell { width: 28px; height: 28px; background: #ccc; display: flex; justify-content: center; align-items: center; font-size: 14px; font-weight: bold; color: #333; border-radius: 2px; text-shadow: none; cursor: pointer; }
        .mine-revealed { background: #999; }
        .mine-bomb { background: red; }

        #checkpoint-notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #00aa00; color: white; padding: 10px 20px; font-weight: bold; z-index: 10000; display: none; border: 2px solid white; text-shadow: none; box-shadow: 0 0 20px #00ff00; }
    </style>
</head>
<body>
    
    <canvas id="matrix"></canvas>
    <div id="blackout-overlay"></div>
    <div id="chat-box" class="chat-notification"></div>
    <div id="checkpoint-notify">üö© –ü–†–û–ì–†–ï–°–° –°–û–•–†–ê–ù–ï–ù</div>
    
    <div id="progress-indicator">SYSTEM PROGRESS: 0.00%</div>

    <!-- –ö–ù–û–ü–ö–ê –ú–ê–ì–ê–ó–ò–ù–ê -->
    <button id="open-shop-btn" onclick="toggleShop()">–ú–ê–ì–ê–ó–ò–ù</button>

    <!-- –ê–î–ú–ò–ù –ú–ï–ù–Æ -->
    <div id="admin-modal">
        <h3 style="margin-top:0; color:#fff">–ê–î–ú–ò–ù–ö–ê</h3>
        <div class="admin-tabs">
            <button class="tab-btn active" onclick="switchAdminTab('main', this)">–ì–õ–ê–í–ù–ê–Ø</button>
            <button class="tab-btn" onclick="switchAdminTab('events', this)">–ò–í–ï–ù–¢–´</button>
            <button class="tab-btn" onclick="switchAdminTab('tasks', this)">–ó–ê–î–ê–ù–ò–Ø</button>
        </div>

        <div id="adm-main" class="tab-content active">
            <button class="admin-btn" onclick="cheatSkipGate()">–ü–†–û–ü–£–°–¢–ò–¢–¨ –ó–ê–î–ê–ù–ò–ï</button>
            <button class="admin-btn" onclick="cheatAddMoney()">+99 999 999 $</button>
            <div style="margin-top: 10px;">
                <input type="number" id="teleportPercent" class="admin-input" placeholder="%" min="0" max="250">
                <button class="admin-btn" style="width: auto; display: inline-block;" onclick="cheatTeleport()">TP</button>
            </div>
        </div>

        <div id="adm-events" class="tab-content">
            <button class="admin-btn" onclick="startTacoRain()">–î–û–ñ–î–¨ –ò–ó –¢–ê–ö–û</button>
            <button class="admin-btn" onclick="triggerEarthquake()">–ó–ï–ú–õ–ï–¢–†–Ø–°–ï–ù–ò–ï</button>
            <button class="admin-btn" onclick="triggerBlackout()">–¢–ï–ú–ù–û–¢–ê</button>
            <button class="admin-btn" onclick="triggerFreeze()">–ó–ê–ú–û–†–û–ó–ö–ê</button>
            <button class="admin-btn" onclick="triggerInvert()">–ò–ù–í–ï–†–°–ò–Ø</button>
            <button class="admin-btn" onclick="triggerChat()">–ß–ê–¢</button>
            <button class="admin-btn" onclick="triggerFly()">–ú–£–•–ê</button>
            <button class="admin-btn" onclick="triggerGravity()">–ì–†–ê–í–ò–¢–ê–¶–ò–Ø</button>
            <button class="admin-btn" onclick="triggerBlur()">–†–ê–°–§–û–ö–£–°</button>
            <button class="admin-btn" onclick="triggerPulse()">–ü–£–õ–¨–°–ê–¶–ò–Ø</button>
        </div>

        <div id="adm-tasks" class="tab-content">
            <button class="admin-btn" onclick="forceOpenGate('gateMaze')">–õ–ê–ë–ò–†–ò–ù–¢</button>
            <button class="admin-btn" onclick="forceOpenGate('gate2', 5)">–ú–ê–¢–ï–ú–ê–¢–ò–ö–ê</button>
            <button class="admin-btn" onclick="forceOpenGate('gateStroop')">–°–¢–†–£–ü</button>
            <button class="admin-btn" onclick="forceOpenGate('gateOdd')">–õ–ò–®–ù–ï–ï</button>
            <button class="admin-btn" onclick="forceOpenGate('gate4')">2048</button>
            <button class="admin-btn" onclick="forceOpenGate('gateSheep', 5)">–û–í–¶–´</button>
            <button class="admin-btn" onclick="forceOpenGate('gateFlags')">–§–õ–ê–ì–ò</button>
            <button class="admin-btn" onclick="forceOpenGate('gateMines')">–°–ê–ü–ï–†</button>
            <button class="admin-btn" onclick="forceOpenGate('gate3')">–ö–õ–ò–ö–ï–†</button>
            <button class="admin-btn" onclick="forceOpenGate('gateMemory')">–ü–ê–ú–Ø–¢–¨</button>
            <button class="admin-btn" onclick="forceOpenGate('gateSlider')">–ü–û–õ–ó–£–ù–û–ö</button>
            <button class="admin-btn" onclick="forceOpenGate('gateType')">–ü–ï–ß–ê–¢–¨</button>
            <button class="admin-btn" onclick="forceOpenGate('gateDontPress')">–ù–ï –ù–ê–ñ–ò–ú–ê–ô</button>
        </div>

        <button class="admin-btn" style="margin-top: 15px; background: #500;" onclick="document.getElementById('admin-modal').style.display='none'">–ó–ê–ö–†–´–¢–¨ –ü–ê–ù–ï–õ–¨</button>
    </div>

    <!-- –ö–ï–ô–° –° –ê–ù–ò–ú–ê–¶–ò–ï–ô -->
    <div id="case-modal">
        <div class="case-window"><div class="case-marker"></div><div class="case-strip" id="caseStrip"></div></div>
    </div>

    <!-- –ú–ê–ì–ê–ó–ò–ù –û–ö–ù–û -->
    <div id="shop-modal">
        <div class="shop-title">DARK WEB SHOP</div>
        <div style="text-align:center; margin-bottom:10px;">–ë–ê–õ–ê–ù–°: <span id="coinDisplay" style="color:#0f0">0</span> $</div>
        <div style="text-align:center; font-size:10px; color:#aaa; margin-bottom:5px;">–î–û–•–û–î: +<span id="incomeDisplay">900</span>$/–ú–ò–ù</div>
        
        <button class="shop-btn" onclick="buySkip()"><span>–ü–†–û–ü–£–°–ö –ó–ê–î–ê–ù–ò–Ø</span> <span>5k $</span></button>
        <button class="shop-btn" onclick="openCaseAnimation()"><span>–ö–ï–ô–° –£–î–ê–ß–ò</span> <span>10k $</span></button>
        <button class="shop-btn" onclick="buyShield()"><span>–©–ò–¢ –û–¢ –•–ê–û–°–ê</span> <span>2k $</span></button>
        <button class="shop-btn" onclick="buyInsurance()"><span>–°–¢–†–ê–•–û–í–ö–ê</span> <span>3k $</span></button>
        <button class="shop-btn" onclick="buyMultiplier(3)"><span>x3 –ú–û–ù–ï–¢–´</span> <span>100k $</span></button>
        <button class="shop-btn" onclick="buyMultiplier(4)"><span>x4 –ú–û–ù–ï–¢–´</span> <span>500k $</span></button>
        <button class="shop-btn" onclick="buyMultiplier(5)"><span>x5 –ú–û–ù–ï–¢–´</span> <span>1m $</span></button>
        
        <div style="margin-top:10px; text-align:center; font-size:10px; color:#555;">–ö–ª–∏–∫–Ω–∏ –≤–Ω–µ –æ–∫–Ω–∞ —á—Ç–æ–±—ã –∑–∞–∫—Ä—ã—Ç—å</div>
    </div>

    <div id="login-screen">
        <h1>–°–ò–°–¢–ï–ú–ê –ù–ê–í–ï–î–ï–ù–ò–Ø</h1>
        <div class="subtitle">–í–í–ï–î–ò–¢–ï –ö–û–î –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –ö–û–û–†–î–ò–ù–ê–¢</div>
        <input type="text" id="passwordInput" placeholder="–ö–û–î –î–û–°–¢–£–ü–ê">
        <button class="login-btn" onclick="checkPassword()">–ü–û–õ–£–ß–ò–¢–¨</button>
        <p class="error-msg" id="errorMsg">–ù–ï–í–ï–†–ù–´–ô –ö–û–î</p>
    </div>

    <!-- –¢–ï–õ–û –°–ê–ô–¢–ê -->
    <div id="trap-screen" onclick="randomPopup(event); closeShopIfOpen(event);">
        <div style="position: sticky; top: 20px; z-index: 200;">
            <div class="trap-title">–í–ó–õ–û–ú –°–ò–°–¢–ï–ú–´</div>
            <p style="text-shadow: 1px 1px 0 #000;">–ü–†–û–¢–û–ö–û–õ –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–Ø –ó–ê–ü–£–©–ï–ù</p>
            <div class="fake-loader"><div class="progress-bar" id="progBar"></div></div>
            <div id="statusText" style="font-size: 0.8em; margin-bottom: 20px; text-shadow: 1px 1px 0 #000;">–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>

        <!-- –ö–ù–û–ü–ö–ê –ö–û–û–†–î–ò–ù–ê–¢ - –¢–û–õ–¨–ö–û –í –ù–ê–ß–ê–õ–ï -->
        <button id="runaway-btn" onmouseover="moveButton()">–°–ö–ê–ß–ê–¢–¨ –ö–û–û–†–î–ò–ù–ê–¢–´</button>

        <div class="toggle-container" onclick="stopProp(event)">
            <span>–°–ª–æ–∂–Ω–æ</span>
            <label class="switch">
                <input type="checkbox" id="trollSwitch" onchange="trollToggle()">
                <span class="slider"></span>
            </label>
            <span>–õ–µ–≥–∫–æ</span>
        </div>

        <div class="checkbox-container" onclick="stopProp(event)">
            <input type="checkbox" id="humanCheck" onchange="noHuman(this)">
            <label for="humanCheck">–Ø –Ω–µ —Ä–æ–±–æ—Ç</label>
        </div>

        <div class="help-link" onclick="triggerScreamer(event)">[ ? ] –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?</div>

        <button class="skip-trap-btn" id="skipTrapBtn" onclick="activateSkipTrap()">‚è© –ü–†–û–ü–£–°–¢–ò–¢–¨ –£–†–û–í–ï–ù–¨</button>
        <div class="big-cipher" id="cipherBlock"></div>

        <div class="secret-container" onclick="stopProp(event)">
            <p class="secret-text">
                –¢—ã –ø—Ä–æ—Å—Ç–æ –≥–µ—Ä–æ–π.<br>
                –°–ª–µ–¥—É—é—â–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ –ø—Ä–∏–∫–ª–µ–µ–Ω–∞ —Å–∫–æ—Ç—á–µ–º<br>
                –ó–ê –¢–í–û–ò–ú –¢–ï–õ–ï–í–ò–ó–û–†–û–ú.
            </p>
        </div>
    </div>

    <!-- === –ì–ï–ô–¢–´ === -->
    <div id="gate1" class="gate-overlay"><div class="gate-box"><h2>–ó–ê–ì–ê–î–ö–ê</h2><p id="riddle-text">...</p><input type="text" id="ans1" class="gate-input" placeholder="–û—Ç–≤–µ—Ç..."><br><button class="login-btn" onclick="checkGate1()" style="margin-top:10px;">–û–¢–í–ï–¢–ò–¢–¨</button></div></div>
    <div id="gateMaze" class="gate-overlay"><div class="gate-box"><h2>–õ–ê–ë–ò–†–ò–ù–¢</h2><p>–ò–¥–∏ –ø–æ –ö–†–ê–°–ù–û–ú–£! –ë–µ–ª—ã–π = —Å–º–µ—Ä—Ç—å.</p><div id="maze-container" onmouseover="checkMazeFail(event)"></div></div></div>
    <div id="gate2" class="gate-overlay"><div class="gate-box"><h2 id="math-title">–ú–ê–¢–ï–ú–ê–¢–ò–ö–ê</h2><p id="math-instr">–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä!</p><div id="math-timer" class="timer-display">20</div><h1 id="math-problem" style="color:white; font-size: 2em; margin: 20px 0;">?</h1><input type="number" id="ans2" class="gate-input" placeholder="–ß–∏—Å–ª–æ..."><br><button class="login-btn" onclick="checkGateMath()" style="margin-top:10px;">–û–¢–í–ï–¢–ò–¢–¨</button></div></div>
    <div id="gateMemory" class="gate-overlay"><div class="gate-box"><h2>–ü–ê–ú–Ø–¢–¨ –†–´–ë–ö–ò</h2><p>–ó–∞–ø–æ–º–Ω–∏ —á–∏—Å–ª–æ!</p><h1 id="memNumber" style="font-size:3em; color:yellow;">123456</h1><div id="memInputDiv" style="display:none;"><input type="number" id="memInput" class="gate-input" placeholder="–ß–∏—Å–ª–æ?"><br><button class="login-btn" onclick="checkMemory()" style="margin-top:10px;">–ü–†–û–í–ï–†–ò–¢–¨</button></div></div></div>
    <div id="gateStroop" class="gate-overlay"><div class="gate-box"><h2>–¢–ï–°–¢ –ú–û–ó–ì–ê</h2><p>–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É, —Ü–≤–µ—Ç –∫–æ—Ç–æ—Ä–æ–π —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å <b>–¶–í–ï–¢–û–ú –¢–ï–ö–°–¢–ê</b>!</p><h1 id="stroopWord" style="font-size: 3em; background: #000; padding: 10px;">–¢–ï–ö–°–¢</h1><div class="stroop-grid" id="stroopButtons"></div></div></div>
    <div id="gateSlider" class="gate-overlay"><div class="gate-box"><h2>–¢–û–ß–ù–û–°–¢–¨</h2><p>–£—Å—Ç–∞–Ω–æ–≤–∏ –ø–æ–ª–∑—É–Ω–æ–∫ —Ä–æ–≤–Ω–æ –Ω–∞ <b id="sliderTargetText">77</b>.</p><p id="sliderVal" style="font-size: 2em; color: white;">0</p><input type="range" id="hellSlider" min="0" max="100" value="0" oninput="updateSlider(this.value)" data-current-val="0"><br><button class="login-btn" onclick="checkSlider()" style="margin-top:10px;">–ì–û–¢–û–í–û</button></div></div>
    <div id="gateOdd" class="gate-overlay"><div class="gate-box"><h2>–ù–ê–ô–î–ò –õ–ò–®–ù–ï–ï</h2><p>–ù–∞–π–¥–∏ –æ—Ç–ª–∏—á–∞—é—â–∏–π—Å—è —Å–º–∞–π–ª–∏–∫ –∑–∞ 5 —Å–µ–∫!</p><div id="odd-timer" class="timer-display">5</div><div class="odd-grid" id="oddGrid"></div></div></div>
    <div id="gateType" class="gate-overlay"><div class="gate-box"><h2>–ü–û–°–õ–£–®–ù–û–°–¢–¨</h2><p>–ù–∞–ø–µ—á–∞—Ç–∞–π —Ñ—Ä–∞–∑—É –±–µ–∑ –æ—à–∏–±–æ–∫:</p><p id="typeTarget" style="background: #333; padding: 10px; color: yellow; user-select: none;">...</p><div id="type-timer" class="timer-display">15</div><br><input type="text" id="typeInput" placeholder="–ü–µ—á–∞—Ç–∞–π –∑–¥–µ—Å—å..." style="width: 300px;"><br><button class="login-btn" onclick="checkTyping()" style="margin-top:10px;">–ü–†–û–í–ï–†–ò–¢–¨</button></div></div>
    <div id="gateDontPress" class="gate-overlay"><div class="gate-box"><h2>–¢–ï–†–ü–ï–ù–ò–ï</h2><p>–ù–ï –Ω–∞–∂–∏–º–∞–π –Ω–∞ –∫—Ä–∞—Å–Ω—É—é –∫–Ω–æ–ø–∫—É!</p><div id="dont-timer" class="timer-display" style="border: none;">10</div><br><br><button id="dontPressBtn" onclick="failGate('–°–∫–∞–∑–∞–Ω–æ –∂–µ –ù–ï –ù–ê–ñ–ò–ú–ê–¢–¨!')">DON'T PRESS</button><button id="passDontBtn" class="login-btn" style="display:none; margin-top: 20px;" onclick="passDontPress()">–ü–†–û–ô–¢–ò</button></div></div>
    <div id="gate3" class="gate-overlay"><div class="gate-box"><h2>–ö–õ–ò–ö–ï–†</h2><p>–ù–∞–∂–º–∏ 10 —Ä–∞–∑ –∑–∞ 5 —Å–µ–∫—É–Ω–¥!</p><div id="click-timer" class="timer-display">5.00</div><p>–û—Å—Ç–∞–ª–æ—Å—å: <span id="clickCount" style="color:white; font-size:1.5em;">10</span></p><div style="height: 250px; position: relative; border: 1px dashed #555;"><button id="clickGameBtn" onclick="clickerGame()" style="padding: 10px; background: red; color: white; border: none; font-weight: bold; position: absolute; top: 40%; left: 40%;">–ñ–ú–ò!</button></div><button onclick="startClicker()" id="startClickBtn" style="padding: 10px; background: blue; color: white; border: none; width: 100%; margin-top: 10px;">–ù–ê–ß–ê–¢–¨</button></div></div>
    <div id="gate4" class="gate-overlay"><div class="gate-box"><h2>2048 (7x7)</h2><p>–°–æ–±–µ—Ä–∏ —á–∏—Å–ª–æ 2048.</p><div class="grid-2048" id="grid2048"></div><div class="controls-2048"><div></div><button class="btn-2048" onclick="game2048.move('up')">‚¨ÜÔ∏è</button><div></div><button class="btn-2048" onclick="game2048.move('left')">‚¨ÖÔ∏è</button><button class="btn-2048" onclick="game2048.move('down')">‚¨áÔ∏è</button><button class="btn-2048" onclick="game2048.move('right')">‚û°Ô∏è</button></div></div></div>
    <div id="gateQuiz" class="gate-overlay"><div class="gate-box"><h2>–í–ò–ö–¢–û–†–ò–ù–ê</h2><p>–û—Ç–≤–µ—Ç—å –Ω–∞ 10 –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥!</p><p id="quiz-counter">1/10</p><p id="quiz-q" style="font-size:1.2em; color:yellow;">...</p><div id="quiz-options"></div></div></div>
    <div id="gateSheep" class="gate-overlay"><div class="gate-box"><h2>–ö–û–†–ú–õ–ï–ù–ò–ï</h2><p id="sheep-msg">–ü–µ—Ä–µ—Ç–∞—â–∏ —Ç—Ä–∞–≤—É –Ω–∞ –æ–≤–µ—á–µ–∫!</p><div class="sheep-field" id="sheepField"></div></div></div>
    <div id="gateFlags" class="gate-overlay"><div class="gate-box"><h2>–ì–ï–û–ì–†–ê–§–ò–Ø</h2><p>–£–≥–∞–¥–∞–π 3 —Å—Ç—Ä–∞–Ω—ã –ø–æ —Ñ–ª–∞–≥—É!</p><div class="flag-img" id="flagImg"></div><div class="flag-opts" id="flagOpts"></div></div></div>
    <div id="gateMines" class="gate-overlay"><div class="gate-box"><h2>–°–ê–ü–ï–†</h2><p>–ù–µ –ø–æ–¥–æ—Ä–≤–∏—Å—å. (8 –º–∏–Ω)</p><div class="mine-grid" id="mineGrid"></div><p style="font-size:0.8em; margin-top:10px;">–ù–∞–∂–º–∏ –Ω–∞ –∫–ª–µ—Ç–∫—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å.</p></div></div>

    <div id="payment-modal" onclick="stopProp(event)">
        <h3>–¢–†–ï–ë–£–ï–¢–°–Ø –û–ü–õ–ê–¢–ê</h3><p>–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Å–ø—É—Å–∫–∞ –æ–ø–ª–∞—Ç–∏—Ç–µ –∫–æ–º–∏—Å—Å–∏—é.</p>
        <div style="margin-top: 20px; display: flex; justify-content: space-around; height: 100px; position: relative;">
            <button class="pay-btn" id="payBtn" onmouseover="evadePayBtn()" onclick="payMoney()">–û–ü–õ–ê–¢–ò–¢–¨ 5000 –ú–û–ù–ï–¢</button>
            <button style="padding: 10px; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%);" onclick="payMath()">–Ø –Ω–∏—â–∞—è (–†–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏)</button>
        </div>
    </div>

    <div id="screamer-overlay"><div class="screamer-face">üëπ</div><div class="screamer-text">–ë–£!</div></div>

    <script>
        function stopProp(e) { e.stopPropagation(); }

        // --- –ú–ê–¢–†–ò–¶–ê ---
        let matrixColor = '#440000';
        const canvas = document.getElementById('matrix');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const katakana = '01';
        const fontSize = 16;
        const columns = canvas.width/fontSize;
        const drops = Array(Math.floor(columns)).fill(1);
        function drawMatrix() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = matrixColor; ctx.font = fontSize + 'px monospace';
            for(let i = 0; i < drops.length; i++) {
                const text = katakana.charAt(Math.floor(Math.random() * katakana.length));
                ctx.fillText(text, i*fontSize, drops[i]*fontSize);
                if(drops[i]*fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix, 30);

        // --- –í–•–û–î –ò –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        let coins = 0;
        let baseIncome = 900;
        let incomeMultiplier = 1;
        let hasShield = false;
        let hasInsurance = false;
        let bribes = 0;
        let currentGateId = ""; 
        let isGateOpen = false;
        let reachedCheckpointLevel = 0; 

        const GATES = [
            { id: 'gate1', pct: 0.10, passed: false, type: 'riddle', index: 0 },
            { id: 'gateMaze', pct: 0.15, passed: false, type: 'maze' },
            { id: 'gate2', pct: 0.20, passed: false, type: 'math', level: 1 },
            { id: 'gateMemory', pct: 0.25, passed: false, type: 'memory' },
            { id: 'gateStroop', pct: 0.30, passed: false, type: 'stroop' },
            { id: 'gate2', pct: 0.35, passed: false, type: 'math', level: 2 },
            { id: 'gateSlider', pct: 0.42, passed: false, type: 'slider' },
            { id: 'gate1', pct: 0.45, passed: false, type: 'riddle', index: 1 },
            { id: 'gate2', pct: 0.50, passed: false, type: 'math', level: 3 },
            { id: 'gateOdd', pct: 0.55, passed: false, type: 'odd' },
            { id: 'gateType', pct: 0.60, passed: false, type: 'type' },
            { id: 'gate2', pct: 0.65, passed: false, type: 'math', level: 4 },
            { id: 'gateDontPress', pct: 0.70, passed: false, type: 'dont' },
            { id: 'gate3', pct: 0.75, passed: false, type: 'clicker' },
            { id: 'gate1', pct: 0.80, passed: false, type: 'riddle', index: 2 },
            { id: 'gate2', pct: 0.85, passed: false, type: 'math', level: 5 },
            { id: 'gate4', pct: 0.90, passed: false, type: '2048' },
            { id: 'gateQuiz', pct: 1.50, passed: false, type: 'quiz' },
            { id: 'gateSheep', pct: 2.10, passed: false, type: 'sheep', count: 5, msg: "–ü–æ–∫–æ—Ä–º–∏ –æ–≤–µ—á–µ–∫!" },
            { id: 'gateFlags', pct: 2.20, passed: false, type: 'flags' },
            { id: 'gateSheep', pct: 2.30, passed: false, type: 'sheep', count: 8, msg: "–û–Ω–∏ —Å–Ω–æ–≤–∞ –≥–æ–ª–æ–¥–Ω—ã!" },
            { id: 'gateMines', pct: 0.95, passed: false, type: 'mines' }
        ];

        function checkPassword() {
            var input = document.getElementById("passwordInput").value;
            if (input.toUpperCase().trim() === "–ö–ü–Æ–õ–ü") {
                document.getElementById("login-screen").style.display = "none";
                document.getElementById("trap-screen").style.display = "flex";
                document.getElementById("progress-indicator").style.display = "block";
                document.getElementById("open-shop-btn").style.display = "block";
                startFakeLoading();
                window.addEventListener('scroll', handleScroll);
                startBrokenScroll(); 
                startChaosSystem(); 
                startEconomy();
            } else {
                document.getElementById("errorMsg").style.display = "block";
                document.getElementById("passwordInput").value = "";
            }
        }

        // --- SCROLL HANDLER ---
        function updateThemeColor(gamePercent) {
            if (gamePercent < 1.95) {
                document.body.style.color = '#ff3333';
                document.body.classList.remove('green-theme');
                matrixColor = '#440000';
            } else if (gamePercent >= 2.00) {
                document.body.style.color = '#00ff00';
                document.body.classList.add('green-theme');
                matrixColor = '#004400';
            } else {
                let p = (gamePercent - 1.95) / 0.05; 
                let r = Math.floor(255 * (1 - p));
                let g = Math.floor(51 + (204 * p));
                let b = Math.floor(51 * (1 - p));
                let col = `rgb(${r},${g},${b})`;
                document.body.style.color = col;
                matrixColor = `rgb(${Math.floor(68 * (1-p))}, ${Math.floor(68 * p)}, 0)`;
            }
        }

        function handleScroll() {
            if(isGateOpen) return;
            
            let y = window.scrollY;
            let total = document.body.scrollHeight - window.innerHeight;
            let percent = y / total;
            let gamePercent = percent * 2.5; 
            
            document.getElementById('progress-indicator').innerText = "SYSTEM PROGRESS: " + (gamePercent*100).toFixed(2) + "%";
            updateThemeColor(gamePercent);

            if(gamePercent > 0.74 && reachedCheckpointLevel < 1) { reachedCheckpointLevel = 1; showCheckpoint(); }
            if(gamePercent > 1.00 && reachedCheckpointLevel < 2) { reachedCheckpointLevel = 2; showCheckpoint(); }
            if(gamePercent > 2.00 && reachedCheckpointLevel < 3) { reachedCheckpointLevel = 3; showCheckpoint(); }

            let skipBtn = document.getElementById("skipTrapBtn");
            if ((gamePercent > 0.28 && gamePercent < 0.30) || (gamePercent > 0.80 && gamePercent < 0.82)) {
                skipBtn.style.display = 'block';
                skipBtn.onclick = null; skipBtn.onclick = activateSkipTrap;
            } else skipBtn.style.display = 'none';

            for (let g of GATES) {
                if (gamePercent > g.pct && !g.passed) {
                    if (bribes > 0) { bribes--; g.passed = true; } else { openGate(g); break; }
                }
            }
        }

        function showCheckpoint() {
            let notif = document.getElementById("checkpoint-notify");
            notif.style.display = "block"; setTimeout(() => notif.style.display = "none", 3000);
        }

        function openGate(gate) {
            isGateOpen = true;
            currentGateId = gate.id; 
            activeGateObj = gate;

            if (gate.type === 'riddle') openRiddleGate(gate.index, gate);
            else if (gate.type === 'math') openMathGate(gate.level, gate);
            else if (gate.type === 'maze') openMazeGate(gate);
            else if (gate.type === 'memory') openMemoryGate(gate);
            else if (gate.type === 'stroop') openStroopGate(gate);
            else if (gate.type === 'slider') { openSliderGate(gate); setTimeout(()=> {if(isGateOpen) {document.getElementById('payment-modal').style.display='block';}}, 500); } 
            else if (gate.type === 'odd') openOddGate(gate);
            else if (gate.type === 'type') openTypeGate(gate);
            else if (gate.type === 'dont') openDontPressGate(gate);
            else if (gate.type === 'clicker') startClicker(gate);
            else if (gate.type === '2048') { game2048.init(); document.getElementById('gate4').style.display='flex'; document.body.style.overflow='hidden'; }
            else if (gate.type === 'quiz') openQuizGate(gate);
            else if (gate.type === 'sheep') openSheepGate(gate);
            else if (gate.type === 'flags') openFlagGate(gate);
            else if (gate.type === 'mines') { gameMinesweeper.init(); document.getElementById('gateMines').style.display='flex'; document.body.style.overflow='hidden'; }
        }

        let activeGateObj = null;

        function markGatePassed() {
            if(activeGateObj) activeGateObj.passed = true;
            isGateOpen = false;
            currentGateId = "";
            document.querySelectorAll('.gate-overlay').forEach(el => el.style.display = 'none');
            document.getElementById('payment-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            clearInterval(mathInterval); clearInterval(clickInterval); clearInterval(typeInterval); clearInterval(dontInterval); clearInterval(oddInterval);
        }

        // --- ECONOMY ---
        function startEconomy() { setInterval(() => { coins += (baseIncome * incomeMultiplier); updateShopUI(); }, 60000); }
        function updateShopUI() { 
            document.getElementById('coinDisplay').innerText = coins; 
            document.getElementById('incomeDisplay').innerText = (baseIncome * incomeMultiplier);
        }
        function grantReward() { coins += 100; updateShopUI(); }

        function toggleShop() {
            let s = document.getElementById('shop-modal');
            s.style.display = (s.style.display === 'block') ? 'none' : 'block';
        }
        function closeShopIfOpen(e) {
            let s = document.getElementById('shop-modal');
            let btn = document.getElementById('open-shop-btn');
            if(s.style.display === 'block' && e.target !== s && !s.contains(e.target) && e.target !== btn) {
                s.style.display = 'none';
            }
        }

        function smartTeleport(targetGamePercent) {
            GATES.forEach(g => { if (g.pct < targetGamePercent) g.passed = true; });
            let targetPix = (targetGamePercent / 2.5) * document.body.scrollHeight;
            window.scrollTo(0, targetPix);
        }

        function buySkip() {
            if(isGateOpen) {
                if(coins >= 5000) { coins -= 5000; updateShopUI(); markGatePassed(); alert("–ó–∞–¥–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–æ –∑–∞ –¥–µ–Ω—å–≥–∏."); } 
                else { alert("–ù—É–∂–Ω–æ 5000 $!"); }
            } else { alert("–°–µ–π—á–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è."); }
        }
        function buyShield() { if(coins >= 2000) { coins -= 2000; updateShopUI(); hasShield = true; alert("–©–∏—Ç –∞–∫—Ç–∏–≤–µ–Ω!"); } else { alert("–ù—É–∂–Ω–æ 2000 $!"); } }
        function buyMultiplier(mult) { 
            let cost = 0;
            if(mult === 2) cost = 50000;
            if(mult === 3) cost = 100000;
            if(mult === 4) cost = 500000;
            if(mult === 5) cost = 1000000;
            if(coins >= cost) { coins -= cost; incomeMultiplier = mult; updateShopUI(); alert("–î–æ—Ö–æ–¥ x" + mult + "!"); } else { alert("–ù—É–∂–Ω–æ " + cost + " $!"); } 
        }
        function buyInsurance() { if(coins >= 3000) { coins -= 3000; updateShopUI(); hasInsurance = true; alert("–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∫—É–ø–ª–µ–Ω–∞!"); } else { alert("–ù—É–∂–Ω–æ 3000 $!"); } }
        function buyBribe() { if(coins >= 20000) { coins -= 20000; updateShopUI(); bribes += 3; alert("–í–∑—è—Ç–∫–∞ –¥–∞–Ω–∞. 3 –ø—Ä–æ–ø—É—Å–∫–∞."); } else { alert("–ù—É–∂–Ω–æ 20000 $!"); } }

        // --- PAYMENT LOGIC ---
        function evadePayBtn() {
            let btn = document.getElementById("payBtn");
            let x = Math.random() * 150;
            let y = Math.random() * 50;
            btn.style.transform = `translate(${x}px, ${y}px)`;
        }
        function payMoney() {
            if(coins >= 5000) { coins -= 5000; updateShopUI(); markGatePassed(); alert("–í–∑—è—Ç–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞."); } else { alert("–î–µ–Ω–µ–≥ –Ω–µ—Ç!"); }
        }
        function payMath() {
            document.getElementById('payment-modal').style.display='none';
            openMathGate(5, activeGateObj); 
        }

        // --- ADMIN NEW ---
        let adminClicks = 0;
        document.getElementById('progress-indicator').addEventListener('click', function() {
            adminClicks++;
            if(adminClicks >= 5) {
                adminClicks = 0;
                let pass = prompt("–í–í–ï–î–ò–¢–ï –ü–ê–†–û–õ–¨:");
                if(pass === "1379") document.getElementById('admin-modal').style.display = 'block';
            }
        });

        function switchAdminTab(tabName, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('adm-'+tabName).classList.add('active');
            btn.classList.add('active');
        }

        function cheatSkipGate() { if(isGateOpen) markGatePassed(); }
        function cheatAddMoney() { coins += 99999999; updateShopUI(); }
        function cheatTeleport() {
            let val = parseFloat(document.getElementById('teleportPercent').value);
            if(!isNaN(val)) smartTeleport(val / 100); 
        }
        function forceOpenGate(gateId, param) {
            let gate = GATES.find(g => g.id === gateId || g.type === gateId);
            if(gate) {
                let fakeGate = Object.assign({}, gate); 
                if(param) { fakeGate.level = param; fakeGate.count = param; }
                openGate(fakeGate);
            }
        }

        // --- CASE ANIMATION (10s) ---
        function openCaseAnimation() {
            if(coins < 10000) { alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ (10000)!"); return; }
            coins -= 10000; updateShopUI();
            let modal = document.getElementById('case-modal');
            let strip = document.getElementById('caseStrip');
            modal.style.display = 'block'; strip.innerHTML = ""; strip.style.transform = "translateX(0px)"; 
            let rand = Math.random();
            let resultType = rand < 0.2 ? "green" : (rand < 0.6 ? "yellow" : "red");
            for(let i=0; i<45; i++) {
                let div = document.createElement('div'); div.className = 'case-item';
                if(i === 35) { 
                    div.style.backgroundColor = (resultType==='green'?'lime':(resultType==='yellow'?'yellow':'red'));
                    div.innerText = (resultType==='green' ? "+20%" : (resultType==='yellow' ? "+10%" : "-10%"));
                } else {
                    let r = Math.random();
                    div.style.backgroundColor = r<0.4?'red':(r<0.8?'yellow':'lime');
                    div.innerText = r<0.4?"-10%":(r<0.8?"+10%":"+20%");
                }
                strip.appendChild(div);
            }
            let offset = -3400 + Math.floor(Math.random() * 60 - 30);
            setTimeout(() => { strip.style.transform = `translateX(${offset}px)`; }, 100);
            setTimeout(() => {
                modal.style.display = 'none';
                let currentPct = (window.scrollY / document.body.scrollHeight) * 2.5;
                if(resultType === 'green') { alert("–õ–ï–ì–ï–ù–î–ê–†–ù–û! +20%"); smartTeleport(currentPct + 0.2); }
                else if(resultType === 'yellow') { alert("–û–ë–´–ß–ù–û. +10%"); smartTeleport(currentPct + 0.1); }
                else { alert("–°–ö–ê–ú! -10%"); smartTeleport(Math.max(0, currentPct - 0.1)); }
            }, 10500); 
        }

        // --- FAIL LOGIC ---
        function failGate(reason) {
            if (hasInsurance) { hasInsurance = false; alert("–°–¢–†–ê–•–û–í–ö–ê –°–ü–ê–°–õ–ê!"); return; }
            clearInterval(mathInterval); clearInterval(clickInterval); clearInterval(typeInterval); clearInterval(dontInterval); clearInterval(oddInterval);
            isGateOpen = false;
            document.querySelectorAll('.gate-overlay').forEach(el => el.style.display = 'none');
            document.getElementById('payment-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
            document.getElementById('ans1').value = ""; document.getElementById('ans2').value = ""; document.getElementById('hellSlider').value = 0; document.getElementById('sliderVal').innerText = "0"; document.getElementById('typeInput').value = "";

            if (reachedCheckpointLevel > 0) {
                let targetPct = 0;
                if(reachedCheckpointLevel === 1) targetPct = 0.74;
                if(reachedCheckpointLevel === 2) targetPct = 1.00;
                if(reachedCheckpointLevel === 3) targetPct = 2.00;
                alert("–û–®–ò–ë–ö–ê: " + reason + "\n–í–û–ó–í–†–ê–¢ –ù–ê –ß–ï–ö–ü–û–ò–ù–¢ " + reachedCheckpointLevel + "!");
                smartTeleport(targetPct);
                GATES.forEach(g => { if(g.pct > targetPct) g.passed = false; });
            } else {
                alert("–û–®–ò–ë–ö–ê: " + reason + "\n–ü–û–õ–ù–´–ô –°–ë–†–û–°!");
                window.scrollTo(0, 0); 
                GATES.forEach(g => g.passed = false);
                checkpointReached = false; reachedCheckpointLevel = 0;
            }
        }

        // --- GATES ---
        function openMazeGate(gate) {
            document.getElementById('gateMaze').style.display = 'flex'; document.body.style.overflow = 'hidden';
            let cont = document.getElementById('maze-container'); cont.innerHTML = '<div class="maze-start">START</div><div class="maze-end" onmouseenter="winMaze()">END</div>';
            let paths = [ {top:0, left:0, w:25, h:100}, {top:75, left:0, w:150, h:25}, {top:75, left:125, w:25, h:150}, {top:200, left:50, w:100, h:25}, {top:200, left:50, w:25, h:80}, {top:260, left:50, w:250, h:25}, {top:260, left:270, w:30, h:40} ];
            paths.forEach(p => { let d = document.createElement('div'); d.className='maze-path'; d.style.position='absolute'; d.style.background='red'; d.style.zIndex='5'; d.style.top=p.top+'px'; d.style.left=p.left+'px'; d.style.width=p.w+'px'; d.style.height=p.h+'px'; d.onmouseover = (e) => e.stopPropagation(); cont.appendChild(d); });
        }
        function checkMazeFail(e) { if(e.target.id === 'maze-container') failGate("–£–ø–∞–ª–∞ –≤ –ø—Ä–æ–ø–∞—Å—Ç—å!"); }
        function winMaze() { grantReward(); markGatePassed(); alert("–õ–∞–±–∏—Ä–∏–Ω—Ç –ø—Ä–æ–π–¥–µ–Ω."); }

        const riddles = [ { q: "–ß—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –≤–≤–µ—Ä—Ö, –Ω–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø—É—Å–∫–∞–µ—Ç—Å—è?", a: ["–≤–æ–∑—Ä–∞—Å—Ç", "–≥–æ–¥—ã"] }, { q: "–ó–∏–º–æ–π –∏ –ª–µ—Ç–æ–º –æ–¥–Ω–∏–º —Ü–≤–µ—Ç–æ–º?", a: ["–µ–ª–∫–∞", "—ë–ª–∫–∞", "–µ–ª—å", "—Å–æ—Å–Ω–∞"] }, { q: "–ù–µ –ª–∞–µ—Ç, –Ω–µ –∫—É—Å–∞–µ—Ç, –∞ –≤ –¥–æ–º –Ω–µ –ø—É—Å–∫–∞–µ—Ç?", a: ["–∑–∞–º–æ–∫"] }, { q: "–°–∏–¥–∏—Ç –¥–µ–¥, –≤–æ —Å—Ç–æ —à—É–± –æ–¥–µ—Ç, –∫—Ç–æ –µ–≥–æ —Ä–∞–∑–¥–µ–≤–∞–µ—Ç, —Ç–æ—Ç —Å–ª–µ–∑—ã –ø—Ä–æ–ª–∏–≤–∞–µ—Ç?", a: ["–ª—É–∫"] }, { q: "–í–∏—Å–∏—Ç –≥—Ä—É—à–∞, –Ω–µ–ª—å–∑—è —Å–∫—É—à–∞—Ç—å?", a: ["–ª–∞–º–ø–æ—á–∫–∞", "–ª–∞–º–ø–∞"] }, { q: "–ß—Ç–æ –º–æ–∂–Ω–æ —Å–ª–æ–º–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å?", a: ["–æ–±–µ—â–∞–Ω–∏–µ", "—Å–ª–æ–≤–æ"] } ];
        let currentRiddleIndex = 0;
        function openRiddleGate(idx, gate) { currentRiddleIndex = Math.floor(Math.random() * riddles.length); document.getElementById('riddle-text').innerText = riddles[currentRiddleIndex].q; document.getElementById('ans1').value = ""; document.getElementById('gate1').style.display = 'flex'; document.body.style.overflow = 'hidden'; }
        function checkGate1() { let ans = document.getElementById('ans1').value.toLowerCase().trim(); let correctAnswers = riddles[currentRiddleIndex].a; if (correctAnswers.includes(ans)) { grantReward(); markGatePassed(); alert("–í–µ—Ä–Ω–æ."); } else { failGate("–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç."); } }

        let currentMathAnswer = 0; let mathInterval;
        function openMathGate(level, gate) {
            document.getElementById('math-title').innerText = `–ú–ê–¢–ï–ú–ê–¢–ò–ö–ê ${level}/5`;
            let timeLimit = 20 + (level*5); let probText = ""; let a = Math.floor(Math.random() * 20) + 1; let b = Math.floor(Math.random() * 20) + 1; let c = Math.floor(Math.random() * 10) + 1;
            if (level <= 2) { let types = ['+', '-']; let type = types[Math.floor(Math.random() * types.length)]; if (type === '+') currentMathAnswer = a + b; else currentMathAnswer = a - b; probText = `${a} ${type} ${b} = ?`; } else { let types = ['+', '-', '*']; let t1 = types[Math.floor(Math.random() * types.length)]; let t2 = types[Math.floor(Math.random() * types.length)]; if (t1 === '*') a = Math.floor(Math.random() * 5) + 1; if (t2 === '*') b = Math.floor(Math.random() * 5) + 1; probText = `${a} ${t1} ${b} ${t2} ${c} = ?`; currentMathAnswer = eval(`${a} ${t1} ${b} ${t2} ${c}`); }
            document.getElementById('math-instr').innerText = `–†–µ—à–∏ –ø—Ä–∏–º–µ—Ä –∑–∞ ${timeLimit} —Å–µ–∫—É–Ω–¥!`; document.getElementById('math-problem').innerText = probText; document.getElementById('ans2').value = ""; document.getElementById('math-timer').innerText = timeLimit; document.getElementById('gate2').style.display = 'flex'; document.body.style.overflow = 'hidden';
            if(mathInterval) clearInterval(mathInterval); mathInterval = setInterval(() => { timeLimit--; document.getElementById('math-timer').innerText = timeLimit; if (timeLimit <= 0) { clearInterval(mathInterval); failGate("–í—Ä–µ–º—è –≤—ã—à–ª–æ"); } }, 1000);
        }
        function checkGateMath() { let ans = parseInt(document.getElementById('ans2').value); if (ans === currentMathAnswer) { clearInterval(mathInterval); grantReward(); markGatePassed(); alert("–í–µ—Ä–Ω–æ."); } else { failGate("–û—à–∏–±–∫–∞."); } }

        let memNum = 0;
        function openMemoryGate(gate) { document.getElementById('gateMemory').style.display = 'flex'; document.body.style.overflow = 'hidden'; document.getElementById('memInputDiv').style.display = 'none'; memNum = Math.floor(100000 + Math.random() * 900000); document.getElementById('memNumber').innerText = memNum; document.getElementById('memNumber').style.display = 'block'; setTimeout(() => { document.getElementById('memNumber').style.display = 'none'; document.getElementById('memInputDiv').style.display = 'block'; }, 2500); }
        function checkMemory() { if(document.getElementById('memInput').value == memNum) { grantReward(); markGatePassed(); alert("–ü–∞–º—è—Ç—å —Ö–æ—Ä–æ—à–∞—è."); } else failGate("–ó–∞–±—ã–ª–∞ —á–∏—Å–ª–æ."); }

        let stroopCorrectColor = "";
        function openStroopGate(gate) { let colors = ["–ö–†–ê–°–ù–´–ô", "–ó–ï–õ–ï–ù–´–ô", "–°–ò–ù–ò–ô", "–ñ–ï–õ–¢–´–ô"], cssColors = ["red", "lime", "blue", "yellow"]; let textIdx = Math.floor(Math.random() * 4), colorIdx = Math.floor(Math.random() * 4); while(textIdx === colorIdx) colorIdx = Math.floor(Math.random() * 4); document.getElementById('stroopWord').innerText = colors[textIdx]; document.getElementById('stroopWord').style.color = cssColors[colorIdx]; stroopCorrectColor = cssColors[colorIdx]; let btnContainer = document.getElementById('stroopButtons'); btnContainer.innerHTML = ""; let shuffled = [...cssColors].sort(() => 0.5 - Math.random()); shuffled.forEach(c => { let btn = document.createElement("div"); btn.className = "stroop-btn"; btn.style.background = c; btn.innerText = "–í–´–ë–†–ê–¢–¨"; btn.onclick = function() { checkStroop(c); }; btnContainer.appendChild(btn); }); document.getElementById('gateStroop').style.display = 'flex'; document.body.style.overflow = 'hidden'; }
        function checkStroop(color) { if(color === stroopCorrectColor) { grantReward(); markGatePassed(); alert("–í–µ—Ä–Ω–æ."); } else { failGate("–ù–µ —Ç–æ—Ç —Ü–≤–µ—Ç!"); } }

        let sliderTarget = 50;
        function openSliderGate(gate) { document.getElementById('gateSlider').style.display = 'flex'; document.body.style.overflow = 'hidden'; sliderTarget = Math.floor(Math.random() * 80) + 10; document.getElementById('sliderTargetText').innerText = sliderTarget; document.getElementById('hellSlider').value = 0; document.getElementById('sliderVal').innerText = "0"; document.getElementById('hellSlider').dataset.currentVal = 0; }
        function updateSlider(val) { let jitter = Math.floor(Math.random() * 15) - 7; let finalVal = parseInt(val) + jitter; if(finalVal < 0) finalVal = 0; if(finalVal > 100) finalVal = 100; document.getElementById('sliderVal').innerText = finalVal; document.getElementById('hellSlider').dataset.currentVal = finalVal; }
        function checkSlider() { let val = parseInt(document.getElementById('hellSlider').dataset.currentVal); if(val == sliderTarget) { grantReward(); markGatePassed(); alert("–¢–æ—á–Ω–æ."); } else { failGate("–ù—É–∂–Ω–æ " + sliderTarget); } }

        let oddInterval;
        function openOddGate(gate) { document.getElementById('gateOdd').style.display = 'flex'; document.body.style.overflow = 'hidden'; let grid = document.getElementById('oddGrid'); grid.innerHTML = ""; let oddIdx = Math.floor(Math.random() * 100); for(let i=0; i<100; i++) { let s = document.createElement('div'); s.className = 'odd-cell'; if(i === oddIdx) { s.innerText = "üòë"; s.onclick = winOdd; } else { s.innerText = "üòê"; s.onclick = () => failGate("–ù–µ —Ç–æ—Ç —Å–º–∞–π–ª–∏–∫!"); } grid.appendChild(s); } let time = 5; document.getElementById('odd-timer').innerText = time; if(oddInterval) clearInterval(oddInterval); oddInterval = setInterval(() => { time--; document.getElementById('odd-timer').innerText = time; if(time <= 0) { clearInterval(oddInterval); failGate("–°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–∫–∞–ª–∞!"); } }, 1000); }
        function winOdd() { clearInterval(oddInterval); grantReward(); markGatePassed(); alert("–ì–ª–∞–∑ –∞–ª–º–∞–∑."); }

        let typeInterval;
        function openTypeGate(gate) { document.getElementById('gateType').style.display = 'flex'; document.body.style.overflow = 'hidden'; let phrases = ["–Ø –æ–±–µ—â–∞—é –±—ã—Ç—å —Ö–æ—Ä–æ—à–µ–π –¥–µ–≤–æ—á–∫–æ–π", "–Ø –ª—é–±–ª—é —Ä–µ—à–∞—Ç—å —É—Ä–∞–≤–Ω–µ–Ω–∏—è", "–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–¥–∞–º—Å—è"]; document.getElementById('typeTarget').innerText = phrases[Math.floor(Math.random() * phrases.length)]; let time = 15; document.getElementById('type-timer').innerText = time; if(typeInterval) clearInterval(typeInterval); typeInterval = setInterval(() => { time--; document.getElementById('type-timer').innerText = time; if(time <= 0) { clearInterval(typeInterval); failGate("–°–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—á–∞—Ç–∞–µ—à—å"); } }, 1000); }
        function checkTyping() { if(document.getElementById('typeInput').value === document.getElementById('typeTarget').innerText) { clearInterval(typeInterval); grantReward(); markGatePassed(); alert("–£–º–Ω–∏—Ü–∞."); } else { failGate("–û—à–∏–±–∫–∞."); } }

        let dontInterval;
        function openDontPressGate(gate) { document.getElementById('gateDontPress').style.display = 'flex'; document.body.style.overflow = 'hidden'; document.getElementById('passDontBtn').style.display = 'none'; document.getElementById('dontPressBtn').style.display = 'inline-block'; let time = 10; document.getElementById('dont-timer').innerText = time; if(dontInterval) clearInterval(dontInterval); dontInterval = setInterval(() => { time--; document.getElementById('dont-timer').innerText = time; if(time <= 0) { clearInterval(dontInterval); document.getElementById('dontPressBtn').style.display = 'none'; document.getElementById('passDontBtn').style.display = 'inline-block'; } }, 1000); }
        function passDontPress() { grantReward(); markGatePassed(); alert("–¢–µ—Ä–ø–µ–Ω–∏–µ."); }

        let clicksLeft = 10, clickGameActive = false, clickInterval;
        function startClicker(gate) { if(clickGameActive) return; document.getElementById('gate3').style.display = 'flex'; document.body.style.overflow = 'hidden'; clickGameActive = true; clicksLeft = 10; document.getElementById('clickCount').innerText = clicksLeft; document.getElementById('startClickBtn').style.display = 'none'; let timeLeft = 5.00; document.getElementById('click-timer').innerText = "5.00"; if(clickInterval) clearInterval(clickInterval); clickInterval = setInterval(() => { timeLeft -= 0.01; document.getElementById('click-timer').innerText = timeLeft.toFixed(2); if (timeLeft <= 0) { clearInterval(clickInterval); clickGameActive = false; document.getElementById('startClickBtn').style.display = 'block'; failGate("–ú–µ–¥–ª–µ–Ω–Ω–æ!"); } }, 10); }
        function clickerGame() { if (!clickGameActive) return; clicksLeft--; document.getElementById('clickCount').innerText = clicksLeft; let btn = document.getElementById('clickGameBtn'); let randX = Math.random() * 200 - 100, randY = Math.random() * 200 - 100; btn.style.transform = `translate(${randX}px, ${randY}px)`; if (clicksLeft <= 0) { clearInterval(clickInterval); clickGameActive = false; grantReward(); markGatePassed(); alert("–ë—ã—Å—Ç—Ä–æ."); } }

        const game2048 = { board: [], score: 0, init: function() { this.board = Array(7).fill().map(() => Array(7).fill(0)); this.spawn(); this.spawn(); this.draw(); document.addEventListener('keydown', this.handleKey); }, spawn: function() { let empty = []; for(let r=0; r<7; r++) for(let c=0; c<7; c++) if(this.board[r][c] === 0) empty.push({r,c}); if(empty.length > 0) { let spot = empty[Math.floor(Math.random() * empty.length)]; this.board[spot.r][spot.c] = Math.random() < 0.9 ? 2 : 4; } }, draw: function() { let html = ''; let won = false; for(let r=0; r<7; r++) { for(let c=0; c<7; c++) { let val = this.board[r][c]; let cls = 'c-' + val; html += `<div class="cell-2048 ${cls}">${val > 0 ? val : ''}</div>`; if(val === 2048) won = true; } } document.getElementById('grid2048').innerHTML = html; if(won) { setTimeout(() => { alert("–ú–û–õ–û–î–ï–¶! 2048 –°–û–ë–†–ê–ù–û."); grantReward(); markGatePassed(); document.removeEventListener('keydown', this.handleKey); }, 500); } }, move: function(dir) { let moved = false; const rotate = matrix => matrix[0].map((val, index) => matrix.map(row => row[index]).reverse()); let b = this.board; if(dir === 'right') b = rotate(rotate(b)); if(dir === 'down') b = rotate(b); if(dir === 'up') b = rotate(rotate(rotate(b))); for(let r=0; r<7; r++) { let row = b[r].filter(x => x); for(let i=0; i < row.length - 1; i++) { if(row[i] === row[i+1]) { row[i] *= 2; row[i+1] = 0; } } row = row.filter(x => x); while(row.length < 7) row.push(0); if(b[r].join(',') !== row.join(',')) moved = true; b[r] = row; } if(dir === 'right') b = rotate(rotate(b)); if(dir === 'down') b = rotate(rotate(rotate(b))); if(dir === 'up') b = rotate(b); this.board = b; if(moved) { this.spawn(); this.draw(); } }, handleKey: function(e) { if(e.key === 'ArrowUp') game2048.move('up'); if(e.key === 'ArrowDown') game2048.move('down'); if(e.key === 'ArrowLeft') game2048.move('left'); if(e.key === 'ArrowRight') game2048.move('right'); } };

        // SHEEP
        function openSheepGate(gate) {
            document.getElementById('gateSheep').style.display = 'flex'; document.body.style.overflow = 'hidden';
            document.getElementById('sheep-msg').innerText = gate.msg;
            let field = document.getElementById('sheepField'); field.innerHTML = "";
            let fedCount = 0;
            for(let i=0; i<gate.count; i++) {
                let s = document.createElement('div'); s.className = 'sheep'; s.innerText = 'üêë';
                s.style.top = Math.random() * 150 + 'px'; s.style.left = Math.random() * 250 + 'px'; s.id = 'sheep'+i;
                field.appendChild(s);
            }
            for(let i=0; i<gate.count; i++) {
                let g = document.createElement('div'); g.className = 'grass'; g.innerText = 'üåø';
                g.style.top = '170px'; g.style.left = (i*30) + 'px'; g.draggable = true;
                g.addEventListener('dragstart', (e) => { e.dataTransfer.setData("text", e.target.id); });
                g.onclick = function() {
                    let sheep = field.querySelectorAll('.sheep:not(.fed)');
                    if(sheep.length > 0) { sheep[0].innerText = 'üòã'; sheep[0].classList.add('fed'); g.style.display = 'none'; fedCount++; if(fedCount >= gate.count) { grantReward(); markGatePassed(); alert("–û–≤—Ü—ã —Å—ã—Ç—ã."); } }
                };
                field.appendChild(g);
            }
        }

        // FLAGS
        const flagsDB = [ {f:"üá∫üá∏", n:"–°–®–ê"}, {f:"üá´üá∑", n:"–§—Ä–∞–Ω—Ü–∏—è"}, {f:"üáØüáµ", n:"–Ø–ø–æ–Ω–∏—è"}, {f:"üáÆüáπ", n:"–ò—Ç–∞–ª–∏—è"}, {f:"üáßüá∑", n:"–ë—Ä–∞–∑–∏–ª–∏—è"}, {f:"üá®üá¶", n:"–ö–∞–Ω–∞–¥–∞"}, {f:"üá¨üáß", n:"–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è"}, {f:"üá©üá™", n:"–ì–µ—Ä–º–∞–Ω–∏—è"} ];
        let flagWins = 0;
        function openFlagGate(gate) { document.getElementById('gateFlags').style.display = 'flex'; document.body.style.overflow = 'hidden'; flagWins = 0; nextFlagRound(); }
        function nextFlagRound() {
            if(flagWins >= 3) { grantReward(); markGatePassed(); alert("–ì–µ–æ–≥—Ä–∞—Ñ!"); return; }
            let correct = flagsDB[Math.floor(Math.random()*flagsDB.length)];
            document.getElementById('flagImg').innerText = correct.f;
            let opts = document.getElementById('flagOpts'); opts.innerHTML = "";
            let choices = [correct.n];
            while(choices.length < 4) { let r = flagsDB[Math.floor(Math.random()*flagsDB.length)].n; if(!choices.includes(r)) choices.push(r); }
            choices.sort(() => 0.5 - Math.random());
            choices.forEach(c => { let b = document.createElement('button'); b.className = 'login-btn'; b.innerText = c; b.style.margin = "5px"; b.onclick = () => { if(c === correct.n) { flagWins++; nextFlagRound(); } else failGate("–ù–µ —Ç–∞ —Å—Ç—Ä–∞–Ω–∞!"); }; opts.appendChild(b); });
        }

        // QUIZ MARATHON
        let quizIdx = 0;
        const quizQuestions = [
            {q:"–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –≤ –≥–æ–¥—É?", o:["365","366","360","–ó–∞–≤–∏—Å–∏—Ç"], a:3},
            {q:"2+2*2?", o:["6","8","4","10"], a:0},
            {q:"–°—Ç–æ–ª–∏—Ü–∞ –ê–≤—Å—Ç—Ä–∞–ª–∏–∏?", o:["–°–∏–¥–Ω–µ–π","–ú–µ–ª—å–±—É—Ä–Ω","–ö–∞–Ω–±–µ—Ä—Ä–∞","–í–µ–Ω–∞"], a:2},
            {q:"–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª '–í–æ–π–Ω—É –∏ –º–∏—Ä'?", o:["–ü—É—à–∫–∏–Ω","–¢–æ–ª—Å—Ç–æ–π","–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π","–ì–æ–≥–æ–ª—å"], a:1},
            {q:"H2O —ç—Ç–æ?", o:["–í–æ–¥–∫–∞","–í–æ–¥–∞","–°–ø–∏—Ä—Ç","–ö–∏—Å–ª–æ—Ç–∞"], a:1},
            {q:"–°–∫–æ–ª—å–∫–æ –Ω–æ–≥ —É –ø–∞—É–∫–∞?", o:["6","8","4","100"], a:0},
            {q:"–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø–ª–∞–Ω–µ—Ç–∞?", o:["–ó–µ–º–ª—è","–ú–∞—Ä—Å","–Æ–ø–∏—Ç–µ—Ä","–°–∞—Ç—É—Ä–Ω"], a:2},
            {q:"–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 5 –≤ –∫–≤–∞–¥—Ä–∞—Ç–µ?", o:["10","20","25","55"], a:2},
            {q:"–ü–µ—Ä–≤—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –∫–æ—Å–º–æ—Å–µ?", o:["–ê—Ä–º—Å—Ç—Ä–æ–Ω–≥","–ì–∞–≥–∞—Ä–∏–Ω","–¢–∏—Ç–æ–≤","–õ–µ–æ–Ω–æ–≤"], a:1},
            {q:"–°–∫–æ–ª—å–∫–æ –ø–∞–ª—å—Ü–µ–≤ —É —á–µ–ª–æ–≤–µ–∫–∞?", o:["10","20","8","–ó–∞–≤–∏—Å–∏—Ç"], a:3}
        ];
        function openQuizGate(gate) {
            quizIdx = 0;
            document.getElementById('gateQuiz').style.display = 'flex'; document.body.style.overflow = 'hidden';
            nextQuizQuestion();
        }
        function nextQuizQuestion() {
            if(quizIdx >= 10) { grantReward(); markGatePassed(); alert("–ì–µ–Ω–∏–π!"); return; }
            let q = quizQuestions[quizIdx];
            document.getElementById('quiz-counter').innerText = (quizIdx+1) + "/10";
            document.getElementById('quiz-q').innerText = q.q;
            let optsDiv = document.getElementById('quiz-options');
            optsDiv.innerHTML = "";
            q.o.forEach((opt, idx) => {
                let b = document.createElement("button"); b.className = "login-btn"; 
                b.style.margin = "5px"; b.innerText = opt;
                b.onclick = () => {
                    if(idx === q.a) { quizIdx++; nextQuizQuestion(); }
                    else failGate("–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!");
                };
                optsDiv.appendChild(b);
            });
        }

        const gameMinesweeper = {
            rows: 8, cols: 8, mines: 8, grid: [], revealedCount: 0,
            init: function() { this.grid = []; this.revealedCount = 0; let mineLocs = new Set(); while(mineLocs.size < this.mines) mineLocs.add(Math.floor(Math.random() * (this.rows * this.cols))); let container = document.getElementById('mineGrid'); container.innerHTML = ""; for(let r=0; r<this.rows; r++) { this.grid[r] = []; for(let c=0; c<this.cols; c++) { let isMine = mineLocs.has(r*this.cols + c); this.grid[r][c] = { isMine: isMine, revealed: false, neighbors: 0 }; let div = document.createElement("div"); div.className = "mine-cell"; div.dataset.r = r; div.dataset.c = c; div.onclick = () => this.clickCell(r, c); container.appendChild(div); } } for(let r=0; r<this.rows; r++) for(let c=0; c<this.cols; c++) { if(this.grid[r][c].isMine) continue; let count = 0; for(let i=-1; i<=1; i++) for(let j=-1; j<=1; j++) { let nr=r+i, nc=c+j; if(nr>=0 && nr<this.rows && nc>=0 && nc<this.cols && this.grid[nr][nc].isMine) count++; } this.grid[r][c].neighbors = count; } },
            clickCell: function(r, c) { if(this.grid[r][c].revealed) return; if(this.grid[r][c].isMine) { this.revealAll(); setTimeout(() => failGate("–ë—É–º! –¢—ã –ø–æ–¥–æ—Ä–≤–∞–ª–∞—Å—å."), 1000); } else { this.reveal(r, c); if(this.revealedCount === (this.rows*this.cols - this.mines)) { grantReward(); markGatePassed(); alert("–ß–ò–°–¢–û! –¢–´ –í–´–ñ–ò–õ–ê!"); } } },
            reveal: function(r, c) { if(r<0 || r>=this.rows || c<0 || c>=this.cols || this.grid[r][c].revealed) return; this.grid[r][c].revealed = true; this.revealedCount++; let cell = document.querySelector(`.mine-cell[data-r='${r}'][data-c='${c}']`); cell.classList.add("mine-revealed"); if(this.grid[r][c].neighbors > 0) cell.innerText = this.grid[r][c].neighbors; else for(let i=-1; i<=1; i++) for(let j=-1; j<=1; j++) this.reveal(r+i, c+j); },
            revealAll: function() { for(let r=0; r<this.rows; r++) for(let c=0; c<this.cols; c++) if(this.grid[r][c].isMine) { let cell = document.querySelector(`.mine-cell[data-r='${r}'][data-c='${c}']`); cell.classList.add("mine-bomb"); cell.innerText = "üí£"; } }
        };

        // --- TROLL & CHAOS ---
        function moveButton() {
            var btn = document.getElementById("runaway-btn");
            var x = Math.max(20, Math.random() * (window.innerWidth - 200));
            var y = Math.max(100, Math.random() * 200); 
            btn.style.position = "absolute"; btn.style.left = x + "px"; btn.style.top = y + "px"; 
        }
        function trollToggle() { var chk = document.getElementById("trollSwitch"); if (chk.checked) { setTimeout(() => { chk.checked = false; alert("–û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞!"); }, 300); } }
        function noHuman(chk) { if (chk.checked) { setTimeout(() => { chk.checked = false; alert("–†–æ–±–æ—Ç–∞–º –≤—Ö–æ–¥ –∑–∞–ø—Ä–µ—â–µ–Ω! ü§ñ"); }, 300); } }
        function triggerScreamer(e) { e.stopPropagation(); var scr = document.getElementById("screamer-overlay"); scr.style.display = "flex"; var count = 0; var inter = setInterval(() => { scr.style.backgroundColor = (scr.style.backgroundColor === 'black') ? 'red' : 'black'; count++; if(count > 10) { clearInterval(inter); scr.style.display = "none"; } }, 100); }
        function randomPopup(e) { if(e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.tagName === 'LABEL') return; if (Math.random() > 0.4) return; var div = document.createElement("div"); div.className = "popup"; div.innerHTML = "<div class='popup-header'>System Error</div>VIRUS DETECTED<br>Sending data..."; div.style.left = (e.clientX) + "px"; div.style.top = (e.clientY + window.scrollY) + "px"; document.body.appendChild(div); setTimeout(() => div.remove(), 1500); }
        function startFakeLoading() { var bar = document.getElementById("progBar"); var width = 0; setInterval(() => { if (width >= 100) width = 0; else width += 2; bar.style.width = width + '%'; }, 50); }
        function startBrokenScroll() { window.addEventListener('scroll', function() { if(!isGateOpen && Math.random() > 0.99) window.scrollBy(0, -200); }); }
        function activateSkipTrap() { alert("–ê–≥–∞, —Ä–∞–∑–º–µ—á—Ç–∞–ª–∞—Å—å! –®–¢–†–ê–§ –ó–ê –õ–ï–ù–¨!"); window.scrollBy(0, -50000); document.getElementById("skipTrapBtn").style.display = 'none'; }
        function movePayBtn() { let btn = document.getElementById("payBtn"); btn.style.position = "relative"; btn.style.left = (Math.random()*200 - 100) + "px"; btn.style.top = (Math.random()*100 - 50) + "px"; }
        function closePayment() { if(activeGateObj && activeGateObj.type === 'slider') markGatePassed(); else {isGateOpen = false; document.getElementById('payment-modal').style.display='none'; document.body.style.overflow='auto';} alert("–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø—Ä–æ—à–µ–ª."); }

        function startChaosSystem() { setInterval(() => { scheduleNextChaos(); }, 1000); }
        let lastChaosTime = 0;
        function scheduleNextChaos() {
            if(hasShield) return;
            let now = Date.now();
            let delay = 30000;
            if (now - lastChaosTime > delay) { triggerRandomChaos(); lastChaosTime = now; }
        }
        function triggerRandomChaos() {
            if(hasShield) { hasShield = false; alert("–©–∏—Ç —Å—Ä–∞–±–æ—Ç–∞–ª!"); return; }
            let rand = Math.random();
            if (rand < 0.1) startTacoRain(); else if (rand < 0.2) triggerEarthquake(); else if (rand < 0.3) triggerBlackout(); else if (rand < 0.4) triggerFreeze(); else if (rand < 0.5) triggerBlur(); else if (rand < 0.6) triggerInvert(); else if (rand < 0.7) triggerPulse(); else if (rand < 0.8) triggerChat(); else if (rand < 0.85) triggerZoom(); else if (rand < 0.9) triggerFly(); else if (rand < 0.95) triggerGravity(); else triggerMultiCursor();
        }
        function triggerZoom() { document.body.classList.add(Math.random()>0.5?'zoom-in-mode':'zoom-out-mode'); setTimeout(()=>document.body.classList.remove('zoom-in-mode','zoom-out-mode'), 3000); }
        function triggerChat() { let msgs = ["–Ø –≤–∏–∂—É —Ç–µ–±—è...", "–í–∫–ª—é—á–∞—é –∫–∞–º–µ—Ä—É...", "–¢—ã –∫—Ä–∞—Å–∏–≤–∞—è...", "–ü–∞—Ä–æ–ª—å —É–∫—Ä–∞–¥–µ–Ω...", "–£–¥–∞–ª—è—é —Ñ–æ—Ç–æ...", "–ö—Ç–æ —Å—Ç–æ–∏—Ç —Å–∑–∞–¥–∏?"]; let box = document.getElementById('chat-box'); box.innerText = "‚ö†Ô∏è –°–ò–°–¢–ï–ú–ê: " + msgs[Math.floor(Math.random()*msgs.length)]; box.style.right = "20px"; setTimeout(()=>{box.style.right="-300px"}, 4000); }
        function triggerMultiCursor() { for(let i=0;i<10;i++){ let c=document.createElement("div");c.className="fake-cursor"; c.style.left=Math.random()*window.innerWidth+"px";c.style.top=Math.random()*window.innerHeight+"px"; document.body.appendChild(c); let int=setInterval(()=>{c.style.left=(parseFloat(c.style.left)+(Math.random()*20-10))+"px";c.style.top=(parseFloat(c.style.top)+(Math.random()*20-10))+"px";},100); setTimeout(()=>{clearInterval(int);c.remove()},4000); } }
        function triggerFly() { let fly=document.createElement("div");fly.innerText="ü™∞";fly.className="fly";document.body.appendChild(fly); let int=setInterval(()=>{fly.style.left=Math.random()*window.innerWidth+"px";fly.style.top=(Math.random()*window.innerHeight+window.scrollY)+"px";},300); setTimeout(()=>{clearInterval(int);fly.remove()},5000); }
        function startTacoRain() { for(let i=0;i<300;i++){let t=document.createElement("div");t.innerText="üåÆ";t.className="taco";t.style.left=Math.random()*window.innerWidth+"px";t.style.animationDuration=(Math.random()*2+1)+"s";document.body.appendChild(t);setTimeout(()=>t.remove(),10000);}}
        function triggerEarthquake() { document.body.classList.add("earthquake-mode"); setTimeout(() => document.body.classList.remove("earthquake-mode"), 5000); }
        function triggerBlackout() { document.getElementById("blackout-overlay").style.display = "block"; setTimeout(() => document.getElementById("blackout-overlay").style.display = "none", 2000); }
        function triggerFreeze() { document.body.classList.add("no-cursor"); setTimeout(() => document.body.classList.remove("no-cursor"), 3000); }
        function triggerBlur() { document.body.classList.add("blur-mode"); setTimeout(() => document.body.classList.remove("blur-mode"), 3000); }
        function triggerInvert() { document.body.classList.add("invert-mode"); let fake = document.createElement('div'); fake.className='fake-cursor-img'; document.body.appendChild(fake); let moveH = (e) => { fake.style.left = (window.innerWidth - e.clientX) + 'px'; fake.style.top = (window.innerHeight - e.clientY) + 'px'; }; document.addEventListener('mousemove', moveH); setTimeout(() => { document.body.classList.remove("invert-mode"); fake.remove(); document.removeEventListener('mousemove', moveH); }, 5000); }
        function triggerPulse() { document.body.classList.add("pulse-mode"); setTimeout(() => document.body.classList.remove("pulse-mode"), 4000); }
        function triggerGravity() { document.body.classList.add("gravity-fall"); setTimeout(() => document.body.classList.remove("gravity-fall"), 2000); }
    </script>
</body>
</html>
